<!-- This code uses much of the code from molSimplify Lite. There are additional buttons for solvent removal and thermal stability predictions, and many MOF centered operations (visualization, component identification, etc). An example MOF is prepared by default, using fetch. 

In a terminal, navigate to folder containing app.py.
Then, to open the website, run python app.py in the terminal. Copy and paste http://0.0.0.0:8000/ into the Safari URL bar.

-->


<!-- Import NGL, webGavrog, and Bootstrap libaries--> 
<script src="libraries/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="libraries/ngl.js"></script>
<script type="text/javascript" src="libraries/webGavrog/runtime.js"></script>
<script type="text/javascript" src="libraries/webGavrog/vendors.js"></script>
<script type="text/javascript" src="libraries/webGavrog/main.js"></script>
<script src="libraries/3Dmol-min.js"></script>
<script src="libraries/bootstrap.min.js"></script>
<script src="https://cdn.bokeh.org/bokeh/release/bokeh-2.3.1.min.js"></script>

<!-- Import CSS -->
<link rel="stylesheet" href="libraries/bootstrap.min.css">
<link rel="stylesheet" href="libraries/bootstrap_custom.min.css">


<!-- Custom CSS code is placed within the <style> tag: -->
<style>
.btn {
  margin-top: 3px;
}

.mol-container {
  height: 400px;
  position: relative;
/*  width: 500px;
  height: 400px;
  position: relative;*/
}

.form-control {
  margin-bottom:0.1cm;
}

#link {
  color: #00BFFF;
}

#viewportwrapper { grid-area: viz; } /* For MOF visualization */

.round_button {
  border-radius: 25px;
  font-size: 16px;
  font-weight: bold;
}

body {
  /* The font to be used everywhere */
  font-family: Arial, Helvetica, sans-serif;
  color: black;
  font-size: 16px;
}

</style>


<!-- Empty head section: place meta tags and favicon here -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> <!-- Gianmarco addition, debugging -->

<title>MOFSimplify</title> 
<meta name="description" content="MOFSimplify is an online interface to molSimplify, an open source, Python-based utility created by the Kulik group at MIT for the Machine-Learning accelerated generation, prediction, and design of transition metal (coordination) complexes and MOFs." /> 
<meta property="og:type" content="website" />
<meta property="og:description" content="MOFSimplify is an online interface to molSimplify, an open source, Python-based utility created by the Kulik group at MIT for the Machine-Learning accelerated generation, prediction, and design of transition metal (coordination) complexes and MOFs." /> 
<meta property="og:title" content="MOFSimplify" /> 
<meta property="og:image" content="https://molsimplify.mit.edu/logo.png" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://molsimplify.mit.edu/logo.png" />

</head>


<body>

    <!-- The following code creates a navbar. Each navbar item is in a list entry of class "nav-item". -->
    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-primary">
      <div class="container">
        <a href="../" class="navbar-brand">molSimplify</a>
        <button class="navbar-toggler" type='button' data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="about.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://github.com/hjkgrp/molSimplify">Source Code</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://molsimplify.readthedocs.io/en/latest/Installation.html">Installation Instructions</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="http://hjkgrp.mit.edu/molSimplify-tutorials">Tutorials</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://molsimplify.readthedocs.io/en/latest/">Documentation</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="how_to_cite.html">How to Cite</a>
            </li>
          </ul>

        </div>
      </div>
    </div>

  <div class="container">
    <div class="page-header" id="banner">
      <div class="row">
        <div class="col-lg-12 col-md-12 col-sm-12">
          <!-- Title -->
          <h1 style="color:black;"> <span style='font-family: Helvetica;'> MOFSimplify </span> <span style="font-size: 24px;">  (powered by <a id="link" href="https://molsimplify.readthedocs.io/en/latest/">molSimplify</a> from the <a id="link" href="http://hjkgrp.mit.edu/">Kulik group</a> at MIT!) </span></h1>
          <!-- Subtitle -->
          <p class="lead">Predict and view structures and properties of MOFs in your browser below!</p>
          
          <!-- Lead text -->
          <p>For more geometries, properties, and functionality, check out the full molSimplify utility. Learn more in the <a id="link" href="about.html">About</a> tab.</p>
        </div>
      </div>
    </div>


    <!-- The 4 tabs of the website -->
    <ul class="nav nav-pills mb-3" id="pills-tab">
<!--     <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
 --><!--       <li class="nav-item" role="presentation">
        <button class="nav-link active" id="pills-home-tab" data-toggle="pill" data-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Home</button>
      </li> -->
      <li class="nav-item" role="presentation" style='width:25%'>
        <button class="nav-link active" id="pills-start-tab" style='width:100%'>Start</button>
      </li>
      <li class="nav-item" role="presentation" style='width:25%'>
        <button class="nav-link" id="pills-vis-tab" style='width:100%'>Visualization</button>
      </li>
      <li class="nav-item" role="presentation" style='width:25%'>
        <button class="nav-link" id="pills-comp-tab" style='width:100%'>Component Analysis</button>
      </li>
      <li class="nav-item" role="presentation" style='width:25%'>
        <button class="nav-link" id="pills-bb-tab" style='width:100%'>Building Block Construction</button>
      </li>
<!--       <li class="nav-item" role="presentation">
        <button class="nav-link" id="pills-stat-tab" data-toggle="pill" data-target="#pills-stat" type="button" role="tab" aria-controls="pills-stat" aria-selected="false">Status messages and MOF predictions</button>
      </li> -->
    </ul>

    <div id="pills-start">
      <div class='row'>
      
        <b> 1) Select a MOF for analysis </b>
        <!-- Create a section containing buttons -->
        <div class='col-lg-12'>

          <div style='width:100%; text-align:center; margin-top:0.25cm;'>

            <!-- Button for queuing up the example MOF cif file -->
            <button style='display:inline-block; width:33%' class='btn btn-primary round_button' id='load' type='button'>Load example</button>

            <!-- Button for uploading MOF cif file -->
            <button style='display:inline-block; width:33%' class='btn btn-primary round_button' id='upload' type='button'>Upload cif file</button>

            <!-- Button for uploading MOF cif file -->
            <button style='display:inline-block; width:33%' class='btn btn-primary round_button' id='bb-redirect' type='button'>Construct from building blocks</button>
          </div> 

        </div>

        <b style='margin-top: 0.5cm;'> 2) Predict properties of the selected MOF </b>
        <!-- Create a section containing buttons -->
        <div class='col-lg-12'>

          <div style='width:100%; text-align:center; margin-top:0.25cm;'>

            <!-- Button for predicting solvent removal stability of MOF -->
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='predict_s' type='button'>Stability upon solvent removal</button>

            <!-- Button for predicting thermal stability of MOF -->
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='predict_t' type='button'>Thermal stability</button> 

          </div>

        </div>

      </div>

      <!-- Section where the MOF predictions are placed once predictions are made. Also displays which MOF is currently queued up and ready for analysis. -->
      <div class='row' style='margin-top: 0.5cm;'>
          <b> Status messages and MOF predictions </b>
          <div class='col-12' id='upload_status'></div> 
          <div class='col-12' id='solvent_stability_prediction'></div> 
          <div class='col-12' id='thermal_stability_prediction'></div> 
          <div class='col-12' id='thermal_stability_percentile'></div> 
          <div class='col-12' id='chart'></div>

          <p class = 'col-12' style='margin-top: 0.5cm;'> Information on ANN latent space nearest neighbors can be attained after the corresponding prediction has been executed. Nearest neighbors come from the pool of training data (i.e. CoRE MOFs) used to train the ANN.</p>

          <div class = 'col-6'>
          Solvent removal stability ANN nearest neighbors in latent space
          <select class='form-control' id='solvent_neighbors'>
          </select>

          <div style='width:100%; text-align:center; margin-top:0.25cm;'>
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='s_neighbor' type='button'>Show</button> 
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='download_s_neighbor' type='button'>Download</button> 
          </div>
          <div style='width:100%; text-align:center;'>
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='visualize_s_neighbor' type='button'>Visualize</button> 
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='comp_s_neighbor' type='button'>Get components</button> 
          </div>
          <p id='s_neighbor_info'></p>
          </div>

          <div class = 'col-6'>
          Thermal stability ANN nearest neighbors in latent space
          <select class='form-control' id='thermal_neighbors'>
          </select>

          <div style='width:100%; text-align:center; margin-top:0.25cm;'>
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='t_neighbor' type='button'>Show</button> 
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='download_t_neighbor' type='button'>Download</button> 
          </div>
          <div style='width:100%; text-align:center;'>
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='visualize_t_neighbor' type='button'>Visualize</button> 
            <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='comp_t_neighbor' type='button'>Get components</button> 
          </div>
          <p id='t_neighbor_info'></p>
          <div class='col-6' id='tga_plot'></div>

          <div id='tga_explanation' style='display: none; margin-top: 0.5cm;'> 
            <img src='TGA_graphic.png' alt='Explanatory graphic for simplified TGA plots' style='max-width: 120%;'>
            <p> In order to generate the simplified TGA plot, four points on the experimental TGA plot are chosen. These points represent two lines of different slope on the TGA plot. The two lines are extrapolated until they intersect, and the point of intersection is taken to be the breakdown temperature.</p>
          </div>

          </div>

      </div>


    </div>

    <div id="pills-vis">
      <!-- MOF viewer and buttons -->

      <div id="viewportwrapper" style="border-style: solid;border-width:2px;" class="content inactive"> <!-- MOF visualization -->
        <div id="viewportnote" style="position: relative; top: 13em; text-align: center; z-index: 2;">(MOFs are visualized here. Left click to rotate, right click with mouse to move, scroll with mouse to zoom.)</div>
        <div id="cifviewport" style="height:500px;"></div>
      </div>
      <div style="margin-bottom:0.5cm;"></div>
      <div style='width:100%; text-align:center;'>
        <button class='btn btn-primary round_button' style='display:inline-block; width:50%;' id='visualize' type='button'>Visualize selected MOF</button>
      </div>
      <div style='width:100%; text-align:center;'>
        <div style='display:inline-block;' id='currently_visualized'></div> 
      </div>
      <div style='width:100%; text-align:center;'>
        <div style='display:inline-block;' id='status_visualization'></div> 
      </div>


    </div>

    <div id="pills-comp">
      <div class='row'>
        <div class='col-lg-6' style='margin-top: 0.5cm;'>
          <div id='container-01' class='mol-container' style='border-style:solid;border-width:2px;'> 
              <div id='container-01-note' style='position: relative; top: 13em; text-align: center; z-index: 2;'>(MOF linkers and SBUs are visualized here. Left click to rotate, scroll with mouse to zoom.)</div>
            </div>
          <div style="margin-bottom:0.5cm;"></div>
          <div style='width:100%; text-align:center;'>
            <button style='display:inline-block; width:32%' class='btn btn-primary round_button' id='visualize_linker' type='button'>Visualize linker</button>
            <button style='display:inline-block; width:32%' class='btn btn-primary round_button' id='visualize_sbu' type='button'>Visualize SBU</button>
            <button style='display:inline-block; width:32%' class='btn btn-primary round_button' id='reset' type='button'>Reset zoom level</button>
          </div>
        </div>

        <div class='col-lg-6' style='margin-top: 0.5cm;'>
          <!-- Button for getting MOF components for visualization  -->
          <div style='width:100%; text-align:center;'>

            <button style='display:inline-block; width:80%' class='btn btn-primary round_button' id='get_components' type='button'>Get selected MOF components</button>
          </div>

          <p style='margin-top: 0.5cm;'> Can display MOF's linkers and SBUs after clicking the Get selected MOF components button (or the other 'components' buttons). Select the desired linker or SBU, then click Visualize linker or Visualize SBU.</p>

          <div id='comp_MOF'> </div> <!-- Will display information on what MOF's components are currently visualized -->

          <div>
            Linkers
            <select class='form-control' id='linker'>
            </select>
          </div>

          <div>
            SBUs
            <select class='form-control' id='sbu'> </select>
          </div>

          <div style='width:100%; text-align:center; margin-top:0.5cm;'> 
            <button style='display:inline-block; width:80%' class='btn btn-primary round_button' id='toggle_unique_components' type='button'>Only components with unique connectivities</button>

          </div>

          <div class='col-12' id='component_SMILES'></div>
        </div>
      </div>
    </div>

    <div id="pills-bb">
      A way for the user to generate MOFs for analysis, using a topological MOF net and nodular and connecting building blocks (bb). Special thanks to the Snurr and the G&oacutemez-Gualdr&oacuten groups for developing MOF visualization and construction code. <br> <br>

      Note: not every combination of linker, SBU, and net is compatible.

      <!-- Selection box for the linker building block -->
      <div  style="padding-top: 30px">
        Linker, the connecting building block
        <input id="linker_option" class='form-control locksMetrics' list = 'linkers_list' onmousedown="value = '';" />
      </div>

      <!-- Default linkers -->
      <datalist id = 'linkers_list'>
        <!-- Defined near the end of the Javascript section below -->
      </datalist>


      <!-- Selection box for metal SBU building block -->
      <div>
        SBU, the metal-centered nodular building block 
        <input id="sbu_option" class='form-control locksMetrics' list = 'sbus_list' onmousedown="value = '';" />
      </div>

      <!-- Default sbus -->
      <datalist id = 'sbus_list'>
        <!-- Defined near the end of the Javascript section below -->
      </datalist>
      
      <div>
        MOF Net
        <input id="nets_option" class='form-control locksMetrics' list = 'nets_list' onmousedown="value = '';" />
      </div>

      <!-- Default nets -->
      <datalist id = 'nets_list'>
        <!-- Defined near the end of the Javascript section below -->
      </datalist>

      <div style='width:100%; text-align:center; margin-top:0.5cm;'>

        <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='generate' type='button'>Make bb-generated MOF</button>
        <button style='display:inline-block; width:49%' class='btn btn-primary round_button' id='download_generated' type='button'>Download bb-generated MOF</button>
      </div>

    </div>

<!--       <div class="tab-pane fade" id="pills-stat" role="tabpanel" aria-labelledby="pills-stat-tab">

    </div> -->




</div>



<div class="navbar navbar-expand-lg relative navbar-dark bg-primary" style="margin-top: 50px;">
  <div class="container">
      <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link disabled">Site developed and maintained by the Kulik Group at MIT</a>
          </li>
      </ul>
  </div>
</div>

<!-- For cif file upload -->
 <input id="file_input" type="file" name="file_input" style="display:none"/>  
<!-- This will never display anything. Just used to store a MOF cif file if the button "Upload MOF file" is used. -->

<!-- For example MOF file -->
<p id="example_holder"> </p> <!-- This will never display anything. Just used to store a MOF cif file if the button "Load example MOF" is used. -->

<!-- For building block-generated MOF file -->
<p id="bbg_MOF_holder"> </p> <!-- This will never display anything. Just used to store a MOF if the button "Make bb-generated MOF" is used. -->

<!-- For MOF components (xyz file text) -->
<p id="components_holder"> </p> <!-- This will never display anything. Just used to store components if the button "Get selected MOF components" is used. -->

<!-- For solvent removal stability ANN nearest neighbors -->
<p id="solvent_neighbors_holder"> </p> <!-- This will never display anything. Just used to store ANN nearest neighbors if the button "Predict stability upon solvent removal" is used. -->

<!-- For thermal stability ANN nearest neighbors -->
<p id="thermal_neighbors_holder"> </p> <!-- This will never display anything. Just used to store ANN nearest neighbors if the button "Predict thermal stability" is used. -->

</body>



<!-- Begin JavaScript section -->
<script>
  // Lots of this code is from sbu.html at https://github.com/snurr-group/web-mofid, for MOF visualization.

  // ***** Beginning of section with a lot of copied code from the Snurr group's GitHub. *****
  // With some modifications for our purposes, specifically in the handleInput function. Also, the OOM message

  var stage;

  var lsdir = function(path) {
    return FS.readdir(path).filter(function(e) {
      return !['..', '.'].includes(e);  // filter out current and parent dirs
    }).sort();
  };

  // Adapted from examples at http://nglviewer.org/ngl/api/manual/usage/embedding.html
  // and https://codepen.io/pen?template=JNLMXb and http://nglviewer.org/ngldev/api/manual/snippets.html
  document.addEventListener("DOMContentLoaded", function () {
    stage = new NGL.Stage("cifviewport");
    stage.setParameters( {backgroundColor: "white"} );
  });

  var runMOFidCode = function(cifdata) {
    C_obcode = Module.cwrap(
      'analyzeMOFc', 'null', ['string', 'number', 'number']
    );

    if(!FS.analyzePath('/Output').exists) {
      FS.mkdir('/Output');  // See also docs on filesystem API: https://kripken.github.io/emscripten-site/docs/api_reference/Filesystem-API.html
      // Ideally, the C_obcode executable would automatically make all of the directories,
      // but it's broken at least in an old version of Emscripten.
      FS.mkdir('/Output/MetalOxo');
      FS.mkdir('/Output/SingleNode');
      FS.mkdir('/Output/AllNode');
      FS.mkdir('/Output/StandardIsolated');
    }

    var buflen = 65536;
    var ptr = Module._malloc(buflen);
    var buffer= new Uint8Array(Module.HEAPU8.buffer, ptr, buflen); // Get a bytes view on the newly allocated buffer.
    C_obcode(cifdata, ptr, buflen);
    var ans = Module.UTF8ToString(ptr);
    Module._free(ptr);
    return ans;
  };

  var analyzeMOF = function(input_cif_str, cif_name) {
    // Get relevant MOFid/MOFkey information from an input string of CIF-formatted coordinates
    var raw_mofid_output = runMOFidCode(input_cif_str);
    var single_node_topology = getTopology("/Output/SingleNode/topology.cgd");
    var all_node_topology = getTopology("/Output/AllNode/topology.cgd");

    // Extract the MOFid, per run_mofid.py:cif2mofid
    const fragment_info = _extractFragments(raw_mofid_output);
    let mofid_topology = '';
    if (fragment_info.cat == null) {
      mofid_topology = 'NA'
    } else if (single_node_topology == all_node_topology) {
      mofid_topology = single_node_topology;
    } else {
      mofid_topology = single_node_topology + ',' + all_node_topology;
    }

    let mof_name = cif_name;
    if (cif_name.endsWith('.cif') || cif_name.endsWith('.CIF')) {
      mof_name = cif_name.substring(0, cif_name.length - 4);
    }
    const all_fragments = fragment_info.nodes.concat(fragment_info.linkers);
    all_fragments.sort();

    // Assembling the MOFid from id_constructor.py:assemble_mofid
    let mofid = all_fragments.join('.');
    mofid += ' MOFid-v1.';
    mofid += mofid_topology + '.';
    if (fragment_info.cat == 'no_mof') {
      mofid += fragment_info.cat
    } else if (fragment_info.cat != null) {
      mofid += 'cat' + fragment_info.cat;
    } else {
      mofid += 'NA';
    }
    if (mofid.startsWith(' ')) {  // Null linkers.  Make .smi compatible
      mofid = '*' + mofid + 'no_mof';
    }
    mofid += ';' + mof_name;

    // Extract the MOFkey
    var base_mofkey = "";
    if (fragment_info.parsed) {
      base_mofkey = FS.readFile("/Output/MetalOxo/mofkey_no_topology.txt", {'encoding': 'utf8'});
    }
    var mofkey = base_mofkey.replace('MOFkey-v1', 'MOFkey-v1.' + single_node_topology);

    return {
      raw_output: raw_mofid_output,
      mofid: mofid,
      mofkey: mofkey,
      fragments: fragment_info
    };
  }

  var _extractFragments = function(raw_mofid_output) {
    // Parse the MOFid output, per id_constructor.py:extract_fragments
    let all_fragments = raw_mofid_output.trim().split(/\r\n|\r|\n/g);
    all_fragments = all_fragments.map(a => a.trim());
    if (all_fragments == '') {
      return {nodes: ['*'], linkers: [], cat: cat, parsed: false};
    }

    const cat_num_line = all_fragments.pop();
    let cat = null;
    if (cat_num_line.includes('simplified net(s)')) {
      cat = (parseInt(cat_num_line[8]) - 1).toString();  // '# Found x simplified net(s)'
      if (cat == '-1') {
        cat = null;
      }
    } else {
      all_fragments = ['*'];
    }

    // Parse node/linker fragment notation
    if (all_fragments[0] != '# Nodes:') {
      return {nodes: ['*'], linkers: [], cat: cat, parsed: false};
    }
    all_fragments.shift();
    const linker_flag_loc = all_fragments.findIndex(line => (line == "# Linkers:"));
    const node_fragments = all_fragments.slice(0, linker_flag_loc);
    const linker_fragments = all_fragments.slice(linker_flag_loc+1);
    node_fragments.sort();
    linker_fragments.sort();

    return {nodes: node_fragments, linkers: linker_fragments, cat: cat, parsed: true};
  }

  var rawToSmiles = function(raw_mofid) {
    // Converts the raw output from the MOFid code to a parseable SMILES format
    var lines = raw_mofid.replace(/\t/g, '').split(/\r\n|\r|\n/g);  // remove trailing tabs before splitting
    lines.pop();  // remove line about number of simplified nets
    return lines.join('.');
  }

  handleInput = function(s_neighbor, t_neighbor) {

    // s_neighbor and t_neighbor are booleans, indicate if we are visualizing a neighbor
    // if not, default to visualize the MOF that is queued up

    if (s_neighbor) { // In this case, want to visualize the solvent stability ANN neighbor
      console.log('Check A')

      // grab the current solvent neighbor MOF cif file

      my_neighbor = $('#solvent_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

      console.log(my_neighbor)

      fetch('http://localhost:8000/neighbor/' + my_neighbor + '.cif').then(response => { // grabbing the MOF from local host
      if(!response.ok) { // catching 404 and other issues
        throw Error(response.statusText);
      } 
        return response.blob();
      }).then(function(blob) { 
        var ciffile = new File([blob], "solvent_neighbor.cif", {type: "", lastModified: Date.now()}) // making a cif file
        handleVisualization(ciffile)

      }).catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
      }) 

    }
    else if (t_neighbor) { // In this case, want to visualize the thermal stability ANN neighbor

      // grab the current solvent neighbor MOF cif file

      my_neighbor = $('#thermal_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown


      fetch('http://localhost:8000/neighbor/' + my_neighbor + '.cif').then(response => { // grabbing the MOF from local host
      if(!response.ok) { // catching 404 and other issues
        throw Error(response.statusText);
      } 
        return response.blob();
      }).then(function(blob) { 
        var ciffile = new File([blob], "thermal_neighbor.cif", {type: "", lastModified: Date.now()}) // making a cif file
        handleVisualization(ciffile)

      }).catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
      }) 

    }
    else { // Visualize the queued up MOF (either the default MOF, the uploaded MOF, or the building block MOF)
      // Code elsewhere in this file makes it so only one of the three will be available, if any of them are available

      if (document.getElementById("file_input").files[0] !== undefined) {
        var ciffile = document.getElementById("file_input").files[0];
      }
      else if (document.getElementById("example_holder").value !== null) {
        var ciffile = document.getElementById("example_holder").value;
      }
      else {
        var ciffile = document.getElementById('bbg_MOF_holder').value;
      }
    }

    handleVisualization(ciffile)
  }

  handleVisualization = function(ciffile) {
    //document.getElementById("obresults").innerHTML = "<code>Processing " + ciffile.name + "</code>";
    var cifreader = new FileReader();
    cifreader.onload = function(event) {
      var mofid_results = analyzeMOF(event.target.result, ciffile.name);
      if (mofid_results.fragments.parsed) {
        const mofid_html = "<div>MOFid:<br /><code>" + mofid_results.mofid + "</code></div>";
        const mofkey_html = "<div>MOFkey:<br /><code>" + mofid_results.mofkey + "</code></div>";
        //document.getElementById("obresults").innerHTML = mofid_html + mofkey_html;

        //clearDropdown("cifdownload");
        updateFileLists();  // populate the initial list of files
        //document.getElementById("folderdownload").selectedIndex = "0";  // back to the orig_mol

        //document.getElementById("resultsdownload").classList.remove("inactive");
        document.getElementById("viewportnote").style.display = "none";
        document.getElementById("viewportwrapper").classList.remove("inactive");


        clearViewer(stage);
        drawEmPDB(stage, "/Output/orig_mol.pdb");
      } else {
        //document.getElementById("obresults").innerHTML = "<pre>Failed to calculate MOFid components</pre>";
        //document.getElementById("resultsdownload").classList.add("inactive");
        document.getElementById("viewportwrapper").classList.add("inactive");
      }
    };
    cifreader.readAsText(ciffile);
  }

  getTopology = function(path_to_cgd) {
    // Extract topology from a generated CGD simplified net
    const raw_rcsr_extract = FS.readFile("/RCSRnets.arc", {'encoding': 'utf8'});
    const raw_cgd = FS.readFile(path_to_cgd, {'encoding': 'utf8'});
    if (!raw_cgd.includes('NODE')) {
      return "ERROR";  // not a MOF: no node building blocks found!
    } else {
      return webGavrog.getRawRCSRTopology(raw_cgd, raw_rcsr_extract);
    }
  }



  updateFileLists = function() {
    //clearDropdown("cifdownload");
    var folder_name = "";//getInputValue("folderdownload");
    var selected_view_index = "none";//document.getElementById("view_type").selectedIndex;

    var filelist;
    var view_value_list = ["original", "nodes_and_linkers", "simplified_net"];
    var view_name_list = ["Original MOF", "Nodes + Linkers", "Simplified topology"];
    if (folder_name == "") {  // original base directory
      filelist = ["orig_mol.cif", "orig_mol.pdb"];
      // Only keeping the original MOF in the viewer types:
      view_value_list = [view_value_list[0]];
      view_name_list = [view_name_list[0]];
      selected_view_index = "0";
    } else {
      filelist = lsdir("/Output/" + folder_name);
      // Removing the original MOF from the viewer types:
      view_value_list.shift();
      view_name_list.shift();
    }
    if (folder_name == "AllNode") {
      // Separate linkers into branches + branch points for the AllNode algorithm
      view_value_list[0] = "nodes_and_branches";
    }

  }


  clearViewer = function(ngl_stage) {
    ngl_stage.removeAllComponents();
  }

  addPDBtoViewer = function(ngl_stage, path_to_cif, color_scheme = "element") {
    var component;
    ngl_stage.loadFile(path_to_cif, {ext: "pdb"}).then( function( o ){
      o.addRepresentation("ball+stick", {colorScheme: color_scheme});
      o.addRepresentation( "unitcell" );
      o.autoView();
      /* See class documentation at http://nglviewer.org/ngl/api/class/src/stage/stage.js~Stage.html */
      /* See also the general documentation at http://nglviewer.org/ngl/api/manual/ */
    } );
    // console.log('PDB check') // TODO debugging
    // console.log(path_to_cif)
    // console.log(ngl_stage)
    return component;
  }

  drawEmPDB = function(ngl_stage, emscripten_path, color_scheme = "element") {
    var cif_string = FS.readFile(emscripten_path, {'encoding': 'utf8'});
    var temp_file = new Blob([cif_string], {type: 'chemical/x-cif'});
    return addPDBtoViewer(ngl_stage, temp_file, color_scheme);
  }

  UniformColor = function(hex_color = 0x000000) {
    return NGL.ColormakerRegistry.addScheme(function(params) {
      this.atomColor = function(atom) {
        return hex_color;
      }
    });
  }


  var statusElement = document.getElementById('status_visualization');
  //var progressElement = document.getElementById('progress');
  //var spinnerElement = document.getElementById('spinner');

  var Module = {
    preRun: [],
    postRun: [], 
    print: (function() {
      var element = document.getElementById('output');
      if (element) element.value = ''; // clear browser cache
      return function(text) {
        if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
        // These replacements are necessary if you render to raw HTML
        //text = text.replace(/&/g, "&amp;");
        //text = text.replace(/</g, "&lt;");
        //text = text.replace(/>/g, "&gt;");
        //text = text.replace('\n', '<br>', 'g');
        console.log(text);
        if (element) {
          element.value += text + "\n";
          element.scrollTop = element.scrollHeight; // focus on bottom
        }
      };
    })(),
    printErr: function(text) {
      if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
      if (0) { // XXX disabled for safety typeof dump == 'function') {
        dump(text + '\n'); // fast, straight to the real console
      } else {
        console.error(text);
      }
    },
    canvas: (function() {

      // As a default initial behavior, pop up an alert when webgl context is lost. To make your
      // application robust, you may want to override this behavior before shipping!
      // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2

      return null;
    })(),
    setStatus: function(text) {
      if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
      if (text === Module.setStatus.text) return;
      var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
      var now = Date.now();
      if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon
      if (m) {
        text = m[1];
        //progressElement.value = parseInt(m[2])*100;
        //progressElement.max = parseInt(m[4])*100;
        //progressElement.hidden = false;
        //spinnerElement.hidden = false;
      } //else {
        //progressElement.value = null;
        //progressElement.max = null;
        //progressElement.hidden = true;
        //if (!text) spinnerElement.style.display = 'none';
      //}
      statusElement.innerHTML = text;
    },
    totalDependencies: 0,
    monitorRunDependencies: function(left) {
      this.totalDependencies = Math.max(this.totalDependencies, left);
      Module.setStatus(left ? 'Preparing... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
    }
  };
  Module.setStatus('Downloading...');
  window.onerror = function(event) {
    Module.setStatus('Exception thrown in visualization, see JavaScript console and refresh page (refreshing fixes the OOM, or out of memory, error).');
    //spinnerElement.style.display = 'none';

    $('#currently_visualized').text(''); // clear the message about which MOF is visualized if OOM occurs

    Module.setStatus = function(text) {
      if (text) Module.printErr('[post-exception status] ' + text);
    };

  };

  // ***** End of section with a lot of copied code. *****


  $(function() {


    // Set up 3Dmol viewer 
    let element = $('#container-01');
    let config = { backgroundColor: 'white' };
    let component_viewer = $3Dmol.createViewer( element, config );
    data = {};

    // Reset zoom level.
    $('#reset').click(function() {
      component_viewer.zoomTo();
    })

    // Upload MOF cif file.  
    $(function() {
      $('#upload').on('click', function() { // button triggers upload
        $('#file_input').trigger('click'); // OS file selection
      });
    });

    // Used for ensuring that only .cif files are uploaded.  
    function getExtension(filename) {
      var parts = filename.split('.');
      return parts[parts.length - 1];
    }

    // Used for ensuring that only .cif files are uploaded.
    function isCif(filename) {
      var ext = getExtension(filename);
      return ext == 'cif';
    }

    // Reset certain fields when a new MOF is uploaded (either the example MOF or a user-specified MOF) or generated with building blocks.
    function renew(action) { // something else was already called reset, so we're calling this renew
        // action will be either 'example', 'input', or 'bb'
        if (action != 'example') {
          document.getElementById('example_holder').value = null; // clears example cif
        }
        else if (action != 'input') {
          document.getElementById('file_input').value = null; // clearing any cifs loaded by the user
        }
        else if (action != 'bb') {
          document.getElementById('bbg_MOF_holder').value = null; // clearing bb-generated MOFs holder
        }

        // clearing previous predictions
        $('#solvent_stability_prediction').text('');
        $('#thermal_stability_prediction').text('');
        $('#thermal_stability_percentile').text('');

        // Clearing everything in the Status messages and MOF predictions section of the website, and the holders. Also clearing SMILES strings of components.
        $('#currently_visualized').text('');
        $('#upload_status').text(''); // now nothing is uploaded
        $('#chart').text('');
        $('#tga_plot').text('');
        $('#s_neighbor_info').text('');
        $('#t_neighbor_info').text('');
        $('#comp_MOF').text('')
        $('#component_SMILES').text(''); // clear the SMILES string of any component that was present
        document.getElementById('toggle_unique_components').textContent = 'Only components with unique connectivities'; // setting button text
        document.getElementById('solvent_neighbors_holder').value = undefined
        document.getElementById('thermal_neighbors_holder').value = undefined
        document.getElementById('components_holder').value = undefined; // clearing the value, so no component visualization is possible
        $('#tga_explanation').hide() // hide the explanatory TGA graphic on simplified TGA plots


        // Clearing visualizations and dropdowns.
        clearViewer(stage); // no MOF is displayed in the visualizer now
        component_viewer.clear(); // likewise, clear component visualizer
        clear_component_dropdowns(); 
        clear_neighbor_dropdowns(); // clear the nearest neighbor dropdowns

        // Re-display messages in the two visualizers.
        document.getElementById('viewportnote').style.display = 'block';
        document.getElementById('viewportnote').innerHTML = '(MOFs are visualized here. Left click to rotate, right click with mouse to move, scroll with mouse to zoom.)';
        document.getElementById('container-01-note').innerHTML = '(MOF linkers and SBUs are visualized here. Left click to rotate, scroll with mouse to zoom.)';
    }

    // This function triggers once the user uploads a file.
    $("#file_input").change(function () { 
        renew('input');

        // Check if uploaded file is a .cif.
        if (! isCif(this.value)) { // if the uploaded file is not a cif
            this.value = null; // clear the non-cif file
            alert("Must be a cif file.");
            return; // if not a cif, doesn't continue     
        }

        let myFile = document.getElementById('file_input').files[0]; // the uploaded file
        $('#upload_status').text('File uploaded: ' + myFile.name);
    });

    // This function triggers when someone clicks the Visualize selected MOF button.
    $("#visualize").on('click', function() {
        let myFile = document.getElementById('file_input').files[0]; // the uploaded file
        let myFile2 = document.getElementById('example_holder').value; // the example MOF, if Load example MOF has been used
        let myFile3 = document.getElementById('bbg_MOF_holder').value; // the generated MOF, if Make bb-generated MOF has been used

        // If neither the example MOF has been loaded, nor has the user uploaded nor generated a MOF, then an alert is raised and the function exits.
        if (myFile == null && myFile2 == null && myFile3 == null) {
          alert("Must upload/generate a cif file first.");
          return;
        }

        alert('Visualization loading, may take up to 30 seconds. Close this alert after reading.') // timing upper limit based on NaX.cif

        document.getElementById("viewportnote").innerHTML = "Loading visualization...";

        handleInput(false, false); // handles visualization, will display the MOF in the appropriate box (viewportwrapper)

        var name = document.getElementById('upload_status').innerHTML; // getting the name of the MOF
        name = name.split(' ');
        name = name.slice(-1)[0]; // getting the last element of the array
        if (name.substring(name.length - 3) != 'cif') { // check the last three characters // if the example MOF is loaded
          name = 'exampleMOF'
        } 

        message = 'Currently visualized MOF: '
        message = message + name

        $('#currently_visualized').text(message);
    })

    // This function triggers when someone clicks the Visualize solvent neighbor button. 
    $("#visualize_s_neighbor").on('click', function() {

        // Ensure there are neighbors to display information on
        if (document.getElementById('solvent_neighbors_holder').value == undefined) {
          alert('Must make solvent removal stability prediction first.');
          return;
        }

        if (document.getElementById('solvent_neighbors_holder').value == 1) {
          alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
          return;
        }

        alert('Visualization loading, may take up to 30 seconds. Close this alert after reading.') // timing upper limit based on NaX.cif

        $('#pills-vis-tab').click() // redirecting to appropriate tab

        document.getElementById("viewportnote").innerHTML = "Loading visualization...";

        handleInput(true, false); // handles visualization, will display the MOF in the appropriate box (viewportwrapper)

        my_neighbor = $('#solvent_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

        message = 'Currently visualized MOF: '
        message = message + my_neighbor

        $('#currently_visualized').text(message);
    })

    // This function triggers when someone clicks the Visualize thermal neighbor button. 
    $("#visualize_t_neighbor").on('click', function() {

        // Ensure there are neighbors to display information on
        if (document.getElementById('thermal_neighbors_holder').value == undefined) {
          alert('Must make thermal stability prediction first.');
          return;
        }

        if (document.getElementById('thermal_neighbors_holder').value == 1) {
          alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
          return;
        }

        alert('Visualization loading, may take up to 30 seconds. Close this alert after reading.') // timing upper limit based on NaX.cif

        $('#pills-vis-tab').click() // redirecting to appropriate tab

        document.getElementById("viewportnote").innerHTML = "Loading visualization...";

        handleInput(false, true); // handles visualization, will display the MOF in the appropriate box (viewportwrapper)

        my_neighbor = $('#thermal_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

        message = 'Currently visualized MOF: '
        message = message + my_neighbor

        $('#currently_visualized').text(message);
    })

    // Generate solvent removal stability prediction when the Predict stability upon solvent removal button is clicked.
    $('#predict_s').click(function() {
      // check if a cif is uploaded
      let myFile = document.getElementById('file_input').files[0]; // the uploaded file
      let myFile2 = document.getElementById('example_holder').value; // the example MOF, if Load example MOF has been used
      let myFile3 = document.getElementById('bbg_MOF_holder').value; // the generated MOF, if Make bb-generated MOF has been used

      // If neither the example MOF has been loaded, nor has the user uploaded nor generated a MOF, then an alert is raised and the function exits.
      if (myFile==undefined) {
        myFile = myFile2;
        if (myFile2 == undefined) {
          myFile = myFile3;
          if (myFile3 == undefined) {
            alert("Must upload/generate a cif file first.");
            return;  
          }
        }
      }

      alert('Prediction loading, please wait for a few seconds. Close this alert after reading.') 

      // myFile.text() is a promise
      myFile.text().then(function(result){
        // result is the text of the loaded .cif file

        $.post("/predict_solvent_stability", JSON.stringify(result)).done(
            function(response) {

                  if (response == 'FAILED') { 
                      alert('Failed to featurize')
                    return; // Do not update solvent stability prediction if prediction failed.
                  }

                  if (! response['in_train']) { // a prediction was made
                    var prediction = response['prediction']

                    // preparing the human-interpretable solvent removal stability prediction
                    if (prediction <= 0.2) {
                      verdict = 'Very confident the MOF is unstable upon solvent removal.';
                      my_color = '#ffad97'
                    }
                    else if (prediction <= 0.4) {
                      verdict = 'Fairly confident the MOF is unstable upon solvent removal.';
                      my_color = '#ffcd97'
                    }
                    else if (prediction <= 0.5) {
                      verdict = 'Uncertain, but predict the MOF is unstable upon solvent removal.';
                      my_color = '#fffa97'
                    }
                    else if (prediction <= 0.6) {
                      verdict = 'Uncertain, but predict the MOF is stable upon solvent removal.';
                      my_color = '#fffa97'
                    }
                    else if (prediction <= 0.8) {
                      verdict = 'Fairly confident the MOF is stable upon solvent removal.';
                      my_color = '#e7ff97'
                    }
                    else {
                      verdict = 'Very confident the MOF is stable upon solvent removal.';
                      my_color = '#90ee90'
                    }

                    $('#solvent_stability_prediction').text('The solvent removal stability prediction is: ' + prediction.toString() + '. ' + verdict ); 

                    stability_field = document.getElementById('solvent_stability_prediction');
                    setColor(stability_field, my_color) // color background based on the prediction

                    // Now that the prediction has been displayed, can move on to the neighbors display.
                    var neighbor_names = response['neighbor_names']
                    var neighbor_distances = response['neighbor_distances'] 

                    // Convert these arrays into a dictionary called neighbors.
                    var neighbors = {}
                    for (i = 0; i < neighbor_names.length; i++) {
                      neighbors[neighbor_names[i]] = neighbor_distances[i]
                    }

                    // Storing the information on the neighbors.
                    document.getElementById('solvent_neighbors_holder').value = neighbors;

                    // Populating the solvent neighbors dropdown.
                    var solvent_dropdown = document.getElementById("solvent_neighbors");

                    // clear dropdown
                    var length = solvent_dropdown.options.length;
                    for (i = length-1; i >= 0; i--) {
                      solvent_dropdown.options[i] = null;
                    }

                    // Populating the solvent neighbors dropdown.
                    for (i = 0; i < neighbor_names.length; i++) {
                      var option = document.createElement('option');
                      option.text = neighbor_names[i];
                      solvent_dropdown.add(option);
                    }
                  }
                  else { // requested MOF was in the training data
                    
                    // Storing information indicating that a prediction was made, but no neighbors are avaialable
                    document.getElementById('solvent_neighbors_holder').value = 1

                    stability_field = document.getElementById('solvent_stability_prediction');
                   
                    if (response['truth'] == 1) {
                      $('#solvent_stability_prediction').text('This MOF is in the training data and is reported to be stable upon solvent removal.');
                      setColor(stability_field, '#90ee90') // color background
                    }
                    else {
                      $('#solvent_stability_prediction').text('This MOF is in the training data and is reported to be unstable upon solvent removal.'); 
                      setColor(stability_field, '#ffad97') // color background 
                    }

                  }

            });
      })
    });


    function setColor(element, color)
    {
      element.style.backgroundColor = color;
    }

    // Generate thermal stability prediction when the Predict thermal stability button is clicked.
    $('#predict_t').click(function() {
      // check if a cif is uploaded
      let myFile = document.getElementById('file_input').files[0]; // the uploaded file
      let myFile2 = document.getElementById('example_holder').value; // the example MOF, if Load example MOF has been used
      let myFile3 = document.getElementById('bbg_MOF_holder').value; // the generated MOF, if Make bb-generated MOF has been used

      // If neither the example MOF has been loaded, nor has the user uploaded nor generated a MOF, then an alert is raised and the function exits.
      if (myFile==undefined) {
        myFile = myFile2;
        if (myFile2 == undefined) {
          myFile = myFile3;
          if (myFile3 == undefined) {
            alert("Must upload/generate a cif file first.");
            return;  
          }
        }
      }

      alert('Prediction loading, please wait for a few seconds. Close this alert after reading.') 

      // myFile.text() is a promise
      myFile.text().then(function(result){
        // result is the text of the loaded .cif file

      $.post("/predict_thermal_stability", JSON.stringify(result)).done(
          function(response) {

                if (response == 'FAILED') { 
                    alert('Failed to featurize')
                  return; // Do not update solvent stability prediction if prediction failed.
                }

                if (! response['in_train']) { // a prediction was made
                  prediction = response['prediction'];
                  $('#thermal_stability_prediction').text('The thermal stability prediction is: Thermal breakdown at ' + prediction); // display prediction result

                  $.post("/thermal_stability_percentile", JSON.stringify(prediction)).done(function(response) {
                    $('#thermal_stability_percentile').text('The percentile of thermal stability of the selected MOF with respect to the MOFs in the training data is: ' + response.toString());

                    percentile_field = document.getElementById('thermal_stability_percentile');
                    if (response >= 80) {
                      setColor(percentile_field, '#90ee90')
                    }
                    else if (response >= 60) {
                      setColor(percentile_field, '#e7ff97')
                    }
                    else if (response >= 40) {
                      setColor(percentile_field, '#fffa97')
                    }
                    else if (response >= 20) {
                      setColor(percentile_field, '#ffcd97')
                    }
                    else {
                      setColor(percentile_field, '#ffad97')
                    }
                  })   

                  myDict = {'prediction': true, 'temperature': prediction}
                  $.post("/plot_thermal_stability", JSON.stringify(myDict)).done(function(response) { // making the thermal breakdown temperatures plot
                    $('#chart').html(response);
                  }) 

                  // Now that the prediction has been displayed, can move on to the neighbors display.
                  var neighbor_names = response['neighbor_names']
                  var neighbor_distances = response['neighbor_distances'] 

                  // Converting these arrays into a dictionary called neighbors.
                  var neighbors = {}
                  for (i = 0; i < neighbor_names.length; i++) {
                    neighbors[neighbor_names[i]] = neighbor_distances[i]
                  }

                  // Storing the information on the neighbors.
                  document.getElementById('thermal_neighbors_holder').value = neighbors;

                  // Populating the thermal neighbors dropdown.
                  var thermal_dropdown = document.getElementById("thermal_neighbors");

                  // clear dropdown
                  var length = thermal_dropdown.options.length;
                  for (i = length-1; i >= 0; i--) {
                    thermal_dropdown.options[i] = null;
                  }

                  // Populating the thermal neighbors dropdown.
                  for (i = 0; i < neighbor_names.length; i++) {
                    var option = document.createElement('option');
                    option.text = neighbor_names[i];
                    thermal_dropdown.add(option);
                  }
                }

                else { // requested MOF was in the training data
                    // Storing information indicating that a prediction was made, but no neighbors are avaialable
                    document.getElementById('thermal_neighbors_holder').value = 1
                   
                    $('#thermal_stability_prediction').text('This MOF is in the training data and is reported to have a thermal breakdown temperature of ' + response['truth']);

                    $.post("/thermal_stability_percentile", JSON.stringify(response['truth'])).done(function(response) {
                      $('#thermal_stability_percentile').text('The percentile of thermal stability of the selected MOF with respect to the MOFs in the training data is: ' + response.toString());

                      console.log('check check')
                      console.log(response)
                      console.log(response >= 60)

                      percentile_field = document.getElementById('thermal_stability_percentile');
                      if (response >= 80) {
                        setColor(percentile_field, '#90ee90')
                      }
                      else if (response >= 60) {
                        setColor(percentile_field, '#e7ff97')
                        console.log('hit')
                      }
                      else if (response >= 40) {
                        setColor(percentile_field, '#fffa97')
                      }
                      else if (response >= 20) {
                        setColor(percentile_field, '#ffcd97')
                      }
                      else {
                        setColor(percentile_field, '#ffad97')
                      }
                  })   

                    myDict = {'prediction': false, 'temperature': response['truth']}
                    $.post("/plot_thermal_stability", JSON.stringify(myDict)).done(function(response) { // making the thermal breakdown temperatures plot
                      $('#chart').html(response);
                    }) 
                }
          });
      })
    });


    // Generate MOF from building blocks when the Make bb-generated MOF button is clicked.
    $('#generate').click(function() {
      renew('bb');

      my_linker = $('#linker_option').val() // Check which linker is selected in the linker building block construction dropdown.
      my_sbu = $('#sbu_option').val() // Check which sbu is selected in the sbu building block construction dropdown.
      my_net = $('#nets_option').val() // Check which net is selected in the net building block dropdown.

      if (my_linker === '') {
        alert("Must choose a linker building block first.");
        return;  
      }
      else if (my_sbu === '') {
        alert("Must choose an sbu building block first.");
        return;  
      }
      else if (my_net === '') {
        alert("Must choose a net first.");
        return;  
      }

      bb_information = {}; // a dictionary
      bb_information.linker = my_linker;
      bb_information.sbu = my_sbu;
      bb_information.net = my_net;

      $.post("/get_bb_generated_MOF", JSON.stringify(bb_information)).done(
          function(response) {

            if (response == 'FAILED') { 
              alert('Failed to generate MOF')
              document.getElementById('bbg_MOF_holder').value = undefined; // clearing the value
              return; 
            }

            var result = JSON.parse(response);

            var name = result.mof_name;

            // The function corresponding to @app.route('/get_bb_generated_MOF', methods=['POST']) on the backend will make a cif file of the building block generated MOF if successful, using ToBaCCo 3.0 code. Files are made in the temp_file_creation/tobacco_3.0/output_cifs folder.

            // grab user ID, then feed that into the fetch operation
            // fetch was having issues with the ID key of session on the backend, so this is a workaround
            $.get("/get_ID").done(
              function(response) {
                my_ID = response 
                console.log('ID check')
                console.log(response)

                fetch('http://localhost:8000/bbcif/primitive_' + name + '~' + my_ID).then(response => { // grabbing the MOF from local host
                  if(!response.ok) { // catching 404 and other issues
                    document.getElementById('bbg_MOF_holder').value = undefined; // clearing the value
                    throw Error(response.statusText);
                  } 
                    return response.blob();
                  }).then(function(blob) { 
                    var myFile = new File([blob], "example.cif", {type: "", lastModified: Date.now()}) // making a cif file
                    document.getElementById('bbg_MOF_holder').value = myFile; //bbMOF

                    $('#upload_status').text('MOF constructed with building blocks: ' + name); // TODO make possible for multiple linkers and sbus?
                  }).catch(error => {
                    $('#upload_status').text('Failed to load');
                    console.error('There has been a problem with your fetch operation:', error);
                  })    
                })
 
        });
    });  

    // Triggers when the Download bb-generated MOF button is clicked.
    $('#download_generated').click(function() {
      if (document.getElementById('bbg_MOF_holder').value == undefined) {
        alert('Must generate MOF with building blocks first, using Make bb-generated MOF button.'); 
        return;
      }

      var myFile = document.getElementById('bbg_MOF_holder').value;
      var name = document.getElementById('upload_status').innerHTML; // getting the name of the MOF
      name = name.split(' ');
      name = name.slice(-1)[0]; // getting the last element of the array

      $.get("/get_ID").done(
        function(response) {
          my_ID = response 
          window.location = '/bbcif/' + name + '~' + my_ID // get file from the temp_file_creation_USERID/tobacco_3.0/output_cifs folder
          // assuming primitive is same as normal file

          fetch('http://localhost:8000/bbcif/primitive_' + name + '~' + my_ID).then(response => { // grabbing the MOF from local host
            if(!response.ok) { // catching 404 and other issues
              document.getElementById('bbg_MOF_holder').value = undefined; // clearing the value
              throw Error(response.statusText);
            } 
              return response.blob();
            }).then(function(blob) { 
              var myFile = new File([blob], "example.cif", {type: "", lastModified: Date.now()}) // making a cif file
              document.getElementById('bbg_MOF_holder').value = myFile; //bbMOF

              $('#upload_status').text('MOF constructed with building blocks: ' + name); // TODO make possible for multiple linkers and sbus?
            }).catch(error => {
              $('#upload_status').text('Failed to load');
              console.error('There has been a problem with your fetch operation:', error);
            })    
        })
    })

    // Load example MOF when the Load example MOF button is clicked.
    $('#load').click(function() {

      fetch('http://localhost:8000/mof_examples/jz4002345_si_002_primitive.cif').then(response => { // grabbing the example MOF from local host
        if(!response.ok) { // catching 404 and other issues
          throw Error(response.statusText);
        } 
          return response.blob();
        }).then(function(blob) {
          renew('example'); // note: I call renew here rather than at the beginning of the load function in order to prevent NGL.Stage from throwing a hissy fit
          var myFile = new File([blob], "example.cif", {type: "", lastModified: Date.now()}) // making a cif file
          document.getElementById('example_holder').value = myFile; // setting the value of example_holder
          $('#upload_status').text('File uploaded: Example MOF cif file (UiO-66 from https://doi.org/10.1021/jz4002345, primitive cell attained via molSimplify)'); // indicating that the example MOF has been uploaded

        }).catch(error => {
          $('#upload_status').text('Failed to upload example MOF');
          console.error('There has been a problem with your fetch operation:', error);
        })      
    });


    // Get MOF linkers and sbus when the Get selected MOF components button is clicked.
    // Returns a dictionary of linkers and sbus, also includes information about number of linkers and sbus
    $('#get_components').click(function() {
      console.log('print check A')

      // check if a cif is uploaded
      let myFile = document.getElementById('file_input').files[0]; // the uploaded file
      let myFile2 = document.getElementById('example_holder').value; // the example MOF, if Load example MOF has been used
      let myFile3 = document.getElementById('bbg_MOF_holder').value; // the generated MOF, if Make bb-generated MOF has been used

      // If neither the example MOF has been loaded, nor has the user uploaded nor generated a MOF, then an alert is raised and the function exits.
      if (myFile==undefined) {
        myFile = myFile2;
        if (myFile2 == undefined) {
          myFile = myFile3;
          if (myFile3 == undefined) {
            alert("Must upload/generate a cif file first.");
            return;  
          }
        }
      }

      console.log('print check B')

      // myFile.text() is a promise
      myFile.text().then(function(result){

        console.log('print check B2')

        // result is the text of the loaded .cif file
        $.post("/get_components", JSON.stringify(result)).done(
          function(response) {

            console.log('print check C')

            if (response == 'FAILED') { 
              alert('Failed to featurize.')
              document.getElementById('components_holder').value = undefined; // clearing the value, so no component visualization is possible
              return; 
            }

            var result = JSON.parse(response);

            clear_component_dropdowns();
            var linker_dropdown = document.getElementById('linker');
            var sbu_dropdown = document.getElementById('sbu');

            num_linkers = result.total_linkers;
            num_sbus = result.total_sbus;

            // Populating the linker dropdown.
            for (i = 1; i <= num_linkers; i++) {
              var option = document.createElement('option');
              option.text = 'Linker ' + i.toString();
              linker_dropdown.add(option);
            }

            // Populating the sbu dropdown.
            for (i = 1; i <= num_sbus; i++) {
              var option = document.createElement('option');
              option.text = 'sbu ' + i.toString();
              sbu_dropdown.add(option);
            }

            console.log('print check D')

            // Storing the linker and sbu data.
            document.getElementById('components_holder').value = result; 


            var name = document.getElementById('upload_status').innerHTML; // getting the name of the MOF
            name = name.split(' ');
            name = name.slice(-1)[0]; // getting the last element of the array
            if (name.substring(name.length - 3) != 'cif') { // check the last three characters // if the example MOF is loaded
              name = 'exampleMOF'
            } 

            console.log('print check E')

            $('#comp_MOF').text('MOF for which components are listed below: ' + name)

            document.getElementById('toggle_unique_components').textContent = 'Only components with unique connectivities'; // reset the uniqueness-filter button
            $('#component_SMILES').text('') // clear the SMILES text
            component_viewer.clear(); // clear component visualizer

        });
      })
    });


    // Get MOF linkers and sbus when the Get solvent neighbor components button is clicked.
    // Returns a dictionary of linkers and sbus, also includes information about number of linkers and sbus
    $('#comp_s_neighbor').click(function() {

      // Ensure there are neighbors to display information on
      if (document.getElementById('solvent_neighbors_holder').value == undefined) {
        alert('Must make solvent removal stability prediction first.');
        return;
      }

      if (document.getElementById('solvent_neighbors_holder').value == 1) {
        alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
        return;
      }

      $('#pills-comp-tab').click() // redirecting to appropriate tab

      my_neighbor = $('#solvent_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

      fetch('http://localhost:8000/neighbor/' + my_neighbor + '.cif').then(response => { // grabbing the MOF from local host
      if(!response.ok) { // catching 404 and other issues
        throw Error(response.statusText);
      } 
        return response.blob();
      }).then(function(blob) { 
        var myFile = new File([blob], "solvent_neighbor.cif", {type: "", lastModified: Date.now()}) // making a cif file

        // next, do the component breakdown

        // myFile.text() is a promise
        myFile.text().then(function(result){
          // result is the text of the loaded .cif file
          $.post("/get_components", JSON.stringify(result)).done(
            function(response) {

              if (response == 'FAILED') { 
                alert('Failed to featurize.')
                document.getElementById('components_holder').value = undefined; // clearing the value, so no component visualization is possible
                return; 
              }

              var result = JSON.parse(response);

              clear_component_dropdowns();
              var linker_dropdown = document.getElementById('linker');
              var sbu_dropdown = document.getElementById('sbu');

              num_linkers = result.total_linkers;
              num_sbus = result.total_sbus;

              // Populating the linker dropdown.
              for (i = 1; i <= num_linkers; i++) {
                var option = document.createElement('option');
                option.text = 'Linker ' + i.toString();
                linker_dropdown.add(option);
              }

              // Populating the sbu dropdown.
              for (i = 1; i <= num_sbus; i++) {
                var option = document.createElement('option');
                option.text = 'sbu ' + i.toString();
                sbu_dropdown.add(option);
              }

              // Storing the linker and sbu data.
              document.getElementById('components_holder').value = result; 

              $('#comp_MOF').text('MOF for which components are listed below: ' + my_neighbor)

              document.getElementById('toggle_unique_components').textContent = 'Only components with unique connectivities'; // reset the uniqueness-filter button
              $('#component_SMILES').text('') // clear the SMILES text
              component_viewer.clear(); // clear component visualizer

          });
        })

      }).catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
      }) 

    });
    
    // Get MOF linkers and sbus when the Get thermal neighbor components button is clicked.
    // Returns a dictionary of linkers and sbus, also includes information about number of linkers and sbus
    $('#comp_t_neighbor').click(function() {

      // Ensure there are neighbors to display information on
      if (document.getElementById('thermal_neighbors_holder').value == undefined) {
        alert('Must make thermal stability prediction first.');
        return;
      }

      if (document.getElementById('thermal_neighbors_holder').value == 1) {
        alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
        return;
      }

      $('#pills-comp-tab').click() // redirecting to appropriate tab

      my_neighbor = $('#thermal_neighbors').val(); // select the thermal stability ANN nearest neighbor selected in the dropdown

      fetch('http://localhost:8000/neighbor/' + my_neighbor + '.cif').then(response => { // grabbing the MOF from local host
      if(!response.ok) { // catching 404 and other issues
        throw Error(response.statusText);
      } 
        return response.blob();
      }).then(function(blob) { 
        var myFile = new File([blob], "thermal_neighbor.cif", {type: "", lastModified: Date.now()}) // making a cif file

        // next, do the component breakdown

        // myFile.text() is a promise
        myFile.text().then(function(result){
          // result is the text of the loaded .cif file
          $.post("/get_components", JSON.stringify(result)).done(
            function(response) {

              if (response == 'FAILED') { 
                alert('Failed to featurize.')
                document.getElementById('components_holder').value = undefined; // clearing the value, so no component visualization is possible
                return; 
              }

              var result = JSON.parse(response);

              clear_component_dropdowns();
              var linker_dropdown = document.getElementById('linker');
              var sbu_dropdown = document.getElementById('sbu');

              num_linkers = result.total_linkers;
              num_sbus = result.total_sbus;

              // Populating the linker dropdown.
              for (i = 1; i <= num_linkers; i++) {
                var option = document.createElement('option');
                option.text = 'Linker ' + i.toString();
                linker_dropdown.add(option);
              }

              // Populating the sbu dropdown.
              for (i = 1; i <= num_sbus; i++) {
                var option = document.createElement('option');
                option.text = 'sbu ' + i.toString();
                sbu_dropdown.add(option);
              }

              // Storing the linker and sbu data.
              document.getElementById('components_holder').value = result; 

              $('#comp_MOF').text('MOF for which components are listed below: ' + my_neighbor)

              document.getElementById('toggle_unique_components').textContent = 'Only components with unique connectivities'; // reset the uniqueness-filter button
              $('#component_SMILES').text('') // clear the SMILES text
              component_viewer.clear(); // clear component visualizer

          });
        })

      }).catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
      }) 

    });


    function clear_component_dropdowns() { // clear dropdowns when upload new file
      // Clearing the linker dropdown.
      var linker_dropdown = document.getElementById('linker');
      var length = linker_dropdown.options.length;
      for (i = length-1; i >= 0; i--) {
        linker_dropdown.options[i] = null;
      }

      // Clearing the sbu dropdown.
      var sbu_dropdown = document.getElementById('sbu');
      var length = sbu_dropdown.options.length;
      for (i = length-1; i >= 0; i--) {
        sbu_dropdown.options[i] = null;
      }
    }

    // Triggers when the Only components with unique connectivites button (or the All components button) is clicked.
    $('#toggle_unique_components').click(function() {

      // Ensure there are components to visualize
      if (document.getElementById('components_holder').value == undefined) {
        alert('Must get a MOF\'s components first.');
        return;
      }

      clear_component_dropdowns();

      // Find the dropdowns.
      var linker_dropdown = document.getElementById('linker');
      var sbu_dropdown = document.getElementById('sbu');

      if (document.getElementById('toggle_unique_components').textContent == 'Only components with unique connectivities') { // Want only unique components.
        document.getElementById('toggle_unique_components').textContent = 'All components'; // cycle the button text on click

        // Getting the unique indices (used to determine which linkers/sbus are unique).
        unique_linker_indices = document.getElementById('components_holder').value.unique_linker_indices;
        unique_sbu_indices = document.getElementById('components_holder').value.unique_sbu_indices;

        // Populating the linker dropdown.
        for (i in unique_linker_indices) {
          j = parseInt(i) + 1; // due to 1 vs 0 indexing; Aditya's code zero indexes, but for web display we 1 index
          var option = document.createElement('option');
          option.text = 'Linker ' + j.toString(); 
          linker_dropdown.add(option);
        }

        // Populating the sbu dropdown.
        for (i in unique_sbu_indices) {
          j = parseInt(i) + 1; // due to 1 vs 0 indexing; Aditya's code zero indexes, but for web display we 1 index
          var option = document.createElement('option');
          option.text = 'sbu ' + j.toString(); 
          sbu_dropdown.add(option);
        }


      }
      else if (document.getElementById('toggle_unique_components').textContent == 'All components') { // Want all components.
        document.getElementById('toggle_unique_components').textContent = 'Only components with unique connectivities'; // cycle the button text on click

        // Getting the total number of linkers and sbus.
        num_linkers = document.getElementById('components_holder').value.total_linkers;
        num_sbus = document.getElementById('components_holder').value.total_sbus;

        // Populating the linker dropdown.
        for (i = 1; i <= num_linkers; i++) {
          var option = document.createElement('option');
          option.text = 'Linker ' + i.toString();
          linker_dropdown.add(option);
        }

        // Populating the sbu dropdown.
        for (i = 1; i <= num_sbus; i++) {
          var option = document.createElement('option');
          option.text = 'sbu ' + i.toString();
          sbu_dropdown.add(option);
        }
      }
    })


    // Visualize the linker after MOF components have been resolved when the Visualize linker button is clicked.
    $('#visualize_linker').click(function() {

      // Ensure there are components to visualize.
      if (document.getElementById('components_holder').value == undefined) {
        alert('Must get a MOF\'s components first.');
        return;
      }

      my_linker = $('#linker').val() // Check which linker is selected in the linker dropdown 
      linker_number = my_linker.split(" "); // an array, split at the space
      linker_number = parseInt(linker_number[1]); // gets the number
      linker_number = linker_number - 1; // due to 1 vs 0 indexing; Aditya's code zero indexes, but for web display we 1 index

      // Getting xyz data.
      dictionary = document.getElementById('components_holder').value;
      my_key = 'linker_' + linker_number;

      geometry = dictionary[my_key];  

      $('#container-01-note').text('');
      component_viewer.clear();
      component_viewer.addModel(geometry, "xyz");
      component_viewer.setStyle({}, {stick:{radius:0.25}});
      component_viewer.zoomTo();
      component_viewer.render();

      // Showing the SMILES string.
      $('#component_SMILES').text('The currently visualized linker\'s SMILES string is ' + dictionary[my_key + '_SMILES'])
    })


    // Visualize the sbu after MOF components have been resolved when the Visualize sbu button is clicked.
    $('#visualize_sbu').click(function() {

      // Ensure there are components to visualize.
      if (document.getElementById('components_holder').value == undefined) {
        alert('Must get a MOF\'s components first.');
        return;
      }

      my_sbu = $('#sbu').val() // Check which sbu is selected in the linker dropdown 
      sbu_number = my_sbu.split(" "); // an array, split at the space
      sbu_number = parseInt(sbu_number[1]); // gets the number
      sbu_number = sbu_number - 1; // due to 1 vs 0 indexing; Aditya's code zero indexes, but for web display we 1 index

      // Getting xyz data.
      dictionary = document.getElementById('components_holder').value;
      my_key = 'sbu_' + sbu_number;

      geometry = dictionary[my_key];

      $('#container-01-note').text('');
      component_viewer.clear();
      component_viewer.addModel(geometry, "xyz");
      component_viewer.setStyle({}, {stick:{radius:0.25}});
      component_viewer.zoomTo();
      component_viewer.render();

      // Showing the SMILES string.
      $('#component_SMILES').text('The currently visualized sbu\'s SMILES string is ' + dictionary[my_key + '_SMILES']);
    })

    function clear_neighbor_dropdowns() { // clear dropdowns when upload new file
      // Clearing solvent stability ANN nearest neighbors dropdown.
      var solvent_dropdown = document.getElementById("solvent_neighbors");
      var length = solvent_dropdown.options.length;
      for (i = length-1; i >= 0; i--) {
        solvent_dropdown.options[i] = null;
      }

      // Clearing thermal stability ANN nearest neighbors dropdown.
      var thermal_dropdown = document.getElementById("thermal_neighbors");
      var length = thermal_dropdown.options.length;
      for (i = length-1; i >= 0; i--) {
        thermal_dropdown.options[i] = null;
      }
    }

    // Get information on a nearest neighbor in solvent removal stability ANN latent space when the Show solvent neighbor info button is clicked.
    $('#s_neighbor').click(function() {
      my_neighbor = $('#solvent_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

      // Ensure there are neighbors to display information on
      if (document.getElementById('solvent_neighbors_holder').value == undefined) {
        alert('Must make solvent removal stability prediction first.');
        return;
      }

      if (document.getElementById('solvent_neighbors_holder').value == 1) {
        alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
        return;
      }

      // Get the latent space distance from the information returned from the prediction.
      dictionary = document.getElementById('solvent_neighbors_holder').value;
      latent_distance = dictionary[my_neighbor];

      if (latent_distance.charAt(0) == '.') { // If the latent distance starts with a decimal, add a zero in front of it
       latent_distance = '0' + latent_distance; 
      }

      // Grab the solvent stability flag and DOI from the appropriate Excel sheet with a POST request.
      $.post("/solvent_neighbor_flag", JSON.stringify(my_neighbor)).done(
        function(response) {
          flag = response['flag'] 
          if (flag == 1) {
            document.getElementById('s_neighbor_info').innerHTML = 'Current nearest neighbor: ' 
              + my_neighbor + ' <br />Current nearest neighbor\'s latent distance: ' + latent_distance
              + '<br />Experimentally observed to be stable upon solvent removal? Yes <br />Nearest neighbor DOI: ' 
              + response['doi']; // <br /> for a new line in display
          }
          else {
            document.getElementById('s_neighbor_info').innerHTML = 'Current nearest neighbor: ' 
              + my_neighbor + ' <br />Current nearest neighbor\'s latent distance: ' + latent_distance
              + '<br />Experimentally observed to be stable upon solvent removal? No <br />Nearest neighbor DOI: '
              + response['doi']; // <br /> for a new line in display
          }
      })
    })


    // Download the cif file of the nearest neighbor in solvent removal stability ANN latent space when the Download solvent neighbor info button is clicked. 
    // Also download a .out file that contains information on the nearest neighbor.
    $('#download_s_neighbor').click(function() {

      // Ensure there are neighbors to display information on
      if (document.getElementById('solvent_neighbors_holder').value == undefined) {
        alert('Must make solvent removal stability prediction first.');
        return;
      }

      if (document.getElementById('solvent_neighbors_holder').value == 1) {
        alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
        return;
      }

      my_neighbor = $('#solvent_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown


      // Making the txt file with information about the neighbor
      // The txt file will contain the following information: prediction type, current MOF, selected CoRE nearest neighbor, latent space distance, and property for nearest neighbor
      var dict = {}
      dict['prediction_type'] = 'solvent'

      var name = document.getElementById('upload_status').innerHTML; // getting the name of the MOF
      name = name.split(' ');
      name = name.slice(-1)[0]; // getting the last element of the array
      if (name.substring(name.length - 3) != 'cif') { // check the last three characters // if the example MOF is loaded
        name = 'exampleMOF'
      } 

      dict['current_MOF'] = name
      dict['selected_neighbor'] = my_neighbor

      // Get the latent space distance from the information returned from the prediction.
      dictionary = document.getElementById('solvent_neighbors_holder').value;
      latent_distance = dictionary[my_neighbor];

      if (latent_distance.charAt(0) == '.') { // If the latent distance starts with a decimal, add a zero in front of it
       latent_distance = '0' + latent_distance; 
      }

      dict['latent_space_distance'] = latent_distance

      $.post("/neighbor_writer", JSON.stringify(dict)).done(
        function(response) {
          // I don't really care about the response, I just want download the .out file after it is written
          window.location = '/neighbor_info/solvent__' + name + '__' + my_neighbor + '.out'
          // I make it a .out file rather than a .txt file to force a download, rather than it being opened in the browser
      })

      setTimeout(function(){
        window.location = '/neighbor/' + my_neighbor + '.cif'; // download cif file from the CoRE2019 folder
      }, 1000); // the delay is to make it possible to download multiple files in the same function

    })

    // Get information on a nearest neighbor in thermal stability ANN latent space when the Show thermal neighbor info button is clicked.
    $('#t_neighbor').click(function() {
      my_neighbor = $('#thermal_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

      // Ensure there are neighbors to display information on.
      if (document.getElementById('thermal_neighbors_holder').value == undefined) {
        alert('Must make thermal stability prediction first.');
        return;
      }

      if (document.getElementById('thermal_neighbors_holder').value == 1) {
        alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
        return;
      }

      // Get the latent space distance from the information returned from the prediction.
      dictionary = document.getElementById('thermal_neighbors_holder').value;
      latent_distance = dictionary[my_neighbor];

      if (latent_distance.charAt(0) == '.') { // If the latent distance starts with a decimal, add a zero in front of it
       latent_distance = '0' + latent_distance; 
      }  

      // Grab the thermal breakdown temperature from the appropriate Excel sheet with a POST request.
      $.post("/thermal_neighbor_T", JSON.stringify(my_neighbor)).done(
        function(response) {
            document.getElementById('t_neighbor_info').innerHTML = 'Current nearest neighbor: ' 
              + my_neighbor + ' <br />Current nearest neighbor\'s latent distance: ' + latent_distance
              + '<br />Experimentally observed thermal breakdown temperature: ' + response['T']
              + '&#8451 <br />Circle in TGA plot marks the breakdown temperature.<br />Nearest neighbor DOI: '
              + response['doi']; // <br /> for a new line in display. &#8451 is degrees celsius in decimal
        })

      $.post("/TGA_plot", JSON.stringify(my_neighbor)).done(function(response) { 
        $('#tga_plot').html(response) // a simplified TGA plot (the two slopes, intersecting at breakdown temperature)
      })

      $('#tga_explanation').show() // show the explanatory TGA graphic on simplified TGA plots


    })


    // Download the cif file of the nearest neighbor in thermal stability ANN latent space when the Download thermal neighbor info button is clicked. 
    // Also download a .out file that contains information on the nearest neighbor.
    $('#download_t_neighbor').click(function() {

      // Ensure there are neighbors to display information on
      if (document.getElementById('thermal_neighbors_holder').value == undefined) {
        alert('Must make thermal stability prediction first.');
        return;
      }

      if (document.getElementById('thermal_neighbors_holder').value == 1) {
        alert('The current MOF was in the training data, where the ground truth was known. The ground truth was returned without neighbors, since the ANN was not necessary.');
        return;
      }

      my_neighbor = $('#thermal_neighbors').val(); // select the solvent stability ANN nearest neighbor selected in the dropdown

      // Making the txt file with information about the neighbor
      // The txt file will contain the following information: prediction type, current MOF, selected CoRE nearest neighbor, latent space distance, and property for nearest neighbor
      var dict = {}
      dict['prediction_type'] = 'thermal'

      var name = document.getElementById('upload_status').innerHTML; // getting the name of the MOF
      name = name.split(' ');
      name = name.slice(-1)[0]; // getting the last element of the array
      if (name.substring(name.length - 3) != 'cif') { // check the last three characters // if the example MOF is loaded
        name = 'exampleMOF'
      } 

      dict['current_MOF'] = name
      dict['selected_neighbor'] = my_neighbor

      // Get the latent space distance from the information returned from the prediction.
      dictionary = document.getElementById('thermal_neighbors_holder').value;
      latent_distance = dictionary[my_neighbor];

      if (latent_distance.charAt(0) == '.') { // If the latent distance starts with a decimal, add a zero in front of it
       latent_distance = '0' + latent_distance; 
      }

      dict['latent_space_distance'] = latent_distance

      $.post("/neighbor_writer", JSON.stringify(dict)).done(
        function(response) {
          // I don't really care about the response, I just want download the .out file after it is written
          window.location = '/neighbor_info/thermal__' + name + '__' + my_neighbor + '.out'
          // I make it a .out file rather than a .txt file to force a download, rather than it being opened in the browser
      })

      // setTimeout(function(){
      //   console.log('Check Check Check')
      //   $.post("/TGA_maker", JSON.stringify(my_neighbor)).done(
      //     function(response){
      //       console.log('Check Check Check 2')
      //       window.location = '/neighbor_info/'.concat(my_neighbor.substring(0,6), '_simplified_TGA.png') // download the simplified TGA plot
      //     })
      // }, 500) // TODO if you ever use this code, consider that the 6 thing will not work for longer file names

      setTimeout(function(){
        window.location = '/neighbor/' + my_neighbor + '.cif'; // download cif file from the CoRE2019 folder
      }, 1000); // the delay is to make it possible to download multiple files in the same function

    })

    // TODO testing out tab functionality
    // https://getbootstrap.com/docs/5.0/components/navs-tabs/
    // https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll
    const container = document.querySelector('#pills-tab')
    const matches = container.querySelectorAll('li.nav-item > button') // Getting the tab options
    var triggerTabList = [].slice.call(matches) // making the tab options into a list
    triggerTabList.forEach(function (triggerEl) { // going through each of the tab options
      console.log('Check hit')
      console.log(triggerEl)
      var tabTrigger = new bootstrap.Tab(triggerEl)

      triggerEl.addEventListener('click', function (event) {
        event.preventDefault()
        tabTrigger.show()
      })
    })

    $('#bb-redirect').click(function(){
      $('#pills-bb-tab').click()
    })

    
    // TODO
    $('#pills-start-tab').click(function(){
      $('#pills-start').show() 
      $('#pills-vis').hide()
      $('#pills-comp').hide()
      $('#pills-bb').hide()
    })

    $('#pills-vis-tab').click(function(){
      // console.log('vis tab clicked')
      $('#pills-start').hide() 
      $('#pills-vis').show()
      $('#pills-comp').hide()
      $('#pills-bb').hide()
    })

    $('#pills-comp-tab').click(function(){
      $('#pills-start').hide() 
      $('#pills-vis').hide()
      $('#pills-comp').show()
      $('#pills-bb').hide()
    })

    $('#pills-bb-tab').click(function(){
      $('#pills-start').hide() 
      $('#pills-vis').hide()
      $('#pills-comp').hide()
      $('#pills-bb').show()
    })

    // Start up page by virtually clicking the Load example MOF button
    $('#load').click();

    // Below: populate the linkers, sbus, and net dropdowns in the building block section.
    // I run a script (tobacco_3.0/scrap_cifs.py) in the tobacco_3.0/edges_database folder, the tobacco_3.0/nodes_database folder, and the tobacco_3.0/template_database folder to get a nice array form of all of the available files. I then paste the array into the appropriate places below (for example, my_linkers = ARRAYOFOPTIONS)

    // Populating the linkers in the building block section

    var my_linkers = new Array();
    my_linkers = ['1B_1TrU', '1B_2Br_Ch', '1B_2CF3_Ch', '1B_2CH3_Ch', '1B_2CN_Ch', '1B_2DoU_Ch', '1B_2F_Ch', '1B_2NH2_Ch', '1B_2NO2_Ch', '1B_2OH_Ch', '1B_2SH_Ch', '1B_2TrU', '1B_2TrU_4H_Ch', '1B_2furan_Ch', '1B_2indole_Ch', '1B_2thiophene_Ch', '1B_4Br_Ch', '1B_4CN_Ch', '1B_4F_Ch,cif', '1B_4H_Ch', '1DoU_Ch', '1TrU_Ch', '2B_1DoU_4H_Ch', '2B_1TrU_2', '2B_1TrU_3', '2B_1TrU_4H_Ch', '2B_2Br_Ch', '2B_2CF3_Ch', '2B_2CH3_Ch', '2B_2CN_Ch', '2B_2F_Ch', '2B_2NH2_Ch', '2B_2NO2_Ch', '2B_2OH_Ch', '2B_2SH_Ch', '2B_2TrU_1_Ch', '2B_2TrU_2_Ch', '2B_4Br_Ch', '2B_4CN_Ch', '2B_4F_Ch', '2B_4H_Ch', '2B_fused_Ch', '2TrU_Ch', '3B_4H_Ch', '3B_fused_8H_Ch', '4B_fused_8H_Ch', 'ntn_edge'];

    var options = '';

    for (var i = 0; i < my_linkers.length; i++) {
      options += '<option value="' + my_linkers[i] + '" />';
    }

    document.getElementById('linkers_list').innerHTML = options; // populating the linkers dropdown

    // Next, populating the nodes in the building block section.

    var my_sbus = new Array();
    my_sbus = ['12c_Ce_1_Ch', '12c_Eu_1_Ch', '12c_Mn_1_Ch', '12c_Tb_1_Ch', '12c_Ti_1_Ch', '12c_Zr_1_Ch', '3c_B_Ch', '3c_Cu_imadazoline_Ch', '3c_pyrrole_Ch', '3c_triazine_Ch', '3c_uranyl', '4c_1anC_Ch', '4c_4B_fused_Ch', '4c_B_Ch', '4c_Cd_1_Ch', '4c_Cu_1_Ch', '4c_In_1_Ch', '4c_Ni_1_Ch', '4c_V_1_Ch', '4c_bicyclooctane_Ch', '4c_ethene_Ch', '4c_porphyrin_Ch', '4c_pyrene_Ch', '4c_pyrene_NU_Ch', '4c_tetrathiafulvalene_Ch', '5c_bicyclooctane_Ch', '5c_pyrrole_Ch', '6c_3B_bicylcooctane_Ch', '6c_Al_1', '6c_Al_1_Ch', '6c_B_Ch', '6c_CdZn_1_Ch', '6c_Cr_1_Ch', '6c_Cu_1_Ch', '6c_Fe_1_Ch', '6c_Mg_1_Ch', '6c_Ni_1_Ch', '6c_Zn_1_Ch', '6c_Zr_1_Ch', '6c_bicyclooctane_Ch', '8c_Co_1_Ch', '8c_Co_2_Ch', '8c_Mn_1_Ch', '8c_Tb_1_Ch', '8c_Zr_1_Ch'];

    var options = '';

    for (var i = 0; i < my_sbus.length; i++) {
      options += '<option value="' + my_sbus[i] + '" />';
    }

    document.getElementById('sbus_list').innerHTML = options; // populating the sbus dropdown

    // Last, populating the nets in the building block section

    var my_nets = new Array();
    my_nets = ['aab', 'abb', 'abf', 'abr', 'aca', 'acaa', 'acs', 'acsa', 'acsf', 'acsg', 'acsh', 'acsi', 'act', 'acta', 'aea', 'aeaa', 'afi', 'afie', 'afw', 'afwa', 'afx', 'afy', 'agw', 'agwa', 'ahq', 'ahqa', 'ahr', 'ahra', 'aht', 'ala', 'alaa', 'alb', 'alba', 'albd', 'albx', 'albxd', 'alc', 'alca', 'alm', 'alw', 'amn', 'amu', 'amua', 'ana', 'anaa', 'anae', 'anaf', 'anh', 'ant', 'anta', 'apc', 'apd', 'apo', 'apoa', 'asc', 'asca', 'asd', 'asda', 'ase', 'asea', 'asf', 'asfa', 'asn', 'asp', 'ast', 'aste', 'asv', 'atn', 'atne', 'ato', 'atoe', 'ats', 'atsa', 'att', 'atv', 'awd', 'aww', 'baa', 'baae', 'bab', 'bac', 'baf', 'bag', 'bah', 'baj', 'bak', 'bal', 'bam', 'ban', 'bao', 'bap', 'baq', 'bar', 'bas', 'bat', 'bau', 'bav', 'baw', 'bax', 'bay', 'baz', 'baza', 'bba', 'bbb', 'bbc', 'bbd', 'bbe', 'bbf', 'bbg', 'bbh', 'bbi', 'bbj', 'bbk', 'bbl', 'bbm', 'bbn', 'bbo', 'bbp', 'bbq', 'bbr', 'bbs', 'bbv', 'bbw', 'bbx', 'bby', 'bbz', 'bca', 'bcb', 'bcd', 'bce', 'bcf', 'bcg', 'bch', 'bcha', 'bcj', 'bcl', 'bcm', 'bcn', 'bco', 'bcp', 'bcq', 'bcs', 'bcsa', 'bct', 'bcu', 'bcuf', 'bcug', 'bcuh', 'bcuhe', 'bcui', 'bcuj', 'bcuk', 'bcul', 'bcut', 'bcux', 'bcuxa', 'bcv', 'bcw', 'bcx', 'bcy', 'bcz', 'bda', 'beb', 'bel', 'bele', 'bem', 'ben', 'bet', 'bik', 'bix', 'bkt', 'bmn', 'bne', 'bnl', 'bnn', 'bnna', 'bnnt', 'bod', 'boe', 'bon', 'bor', 'bora', 'bore', 'bow', 'bpa', 'bpb', 'bpc', 'bpd', 'bpe', 'bpf', 'bpg', 'bpi', 'bpj', 'bpk', 'bpl', 'bpm', 'bpn', 'bpo', 'bpp', 'bpq', 'bpr', 'bps', 'bpt', 'bpu', 'bpv', 'bpw', 'brk', 'brl', 'brla', 'bsn', 'bsv', 'bto', 'btoe', 'btu', 'btv', 'buh', 'buha', 'bva', 'bvh', 'bwt', 'byl', 'bzd', 'cab', 'caba', 'cag', 'cage', 'cai', 'cal', 'cald', 'can', 'cane', 'cao', 'cap', 'cas', 'cat', 'cbd', 'cbn', 'cbo', 'cboe', 'cbs', 'cbt', 'ccg', 'cco', 'cda', 'cdj', 'cdja', 'cdk', 'cdl', 'cdla', 'cdle', 'cdm', 'cdme', 'cdn', 'cdp', 'cdq', 'cds', 'cdsa', 'cdsf', 'cdst', 'cdt', 'cdz', 'cdze', 'cea', 'ceb', 'cec', 'ceca', 'ced', 'ceda', 'cee', 'ceea', 'cef', 'cefa', 'ceg', 'cega', 'ceh', 'ceha', 'cei', 'ceia', 'cej', 'ceja', 'cek', 'ceka', 'cel', 'cela', 'cen', 'cena', 'ceo', 'ceoa', 'cep', 'cepa', 'ceq', 'ceqa', 'cer', 'cera', 'ces', 'cesa', 'cet', 'ceta', 'ceu', 'ceua', 'cev', 'ceva', 'cew', 'cewa', 'cex', 'cexa', 'cez', 'ceza', 'cfc', 'cfcea', 'cfd', 'cfe', 'cgc', 'cgs', 'cha', 'chb', 'che', 'ckp', 'ckq', 'cla', 'clad', 'clh', 'cli', 'clj', 'cmc', 'cmd', 'cml', 'cnd', 'cnw', 'coe', 'coee', 'coi', 'cor', 'cora', 'core', 'cot', 'cota', 'crb', 'crba', 'crbe', 'crd', 'crr', 'crs', 'crsa', 'crsd', 'crt', 'csi', 'csj', 'csk', 'csp', 'csq', 'csqa', 'cssa', 'ctn', 'ctna', 'ctnd', 'ctne', 'ctnx', 'ctt', 'ctta', 'cua', 'cus', 'cut', 'cysa', 'czz', 'czza', 'dag', 'daga', 'dda', 'ddb', 'ddc', 'ddi', 'ddy', 'ddya', 'dea', 'deh', 'dehd', 'dei', 'dft', 'dfte', 'dgn', 'dgp', 'dgq', 'dia', 'diaa', 'diaaa', 'diaf', 'diag', 'diaj', 'diax', 'dma', 'dmb', 'dmc', 'dmd', 'dmda', 'dme', 'dmf', 'dmg', 'dmga', 'dmh', 'dmha', 'dmj', 'dmp', 'dna', 'dnaa', 'dnb', 'dnba', 'dnc', 'dnca', 'dnd', 'dnda', 'dne', 'dnea', 'dnf', 'dnfa', 'dng', 'dnga', 'dni', 'dnia', 'dnid', 'dnj', 'dnja', 'dnk', 'dnka', 'dnl', 'dnla', 'dnm', 'dnma', 'dnn', 'dnna', 'dno', 'dnoa', 'dnp', 'dnpa', 'dnq', 'dnqa', 'dnr', 'dnra', 'dns', 'dnsa', 'dnt', 'dnta', 'dnu', 'dnua', 'dnv', 'dnva', 'dnw', 'dnwa', 'dnx', 'dnxa', 'dny', 'dnya', 'dnz', 'dnza', 'doh', 'dpa', 'dpaa', 'dpb', 'dpba', 'dpc', 'dpca', 'dpd', 'dpda', 'dpe', 'dpea', 'dtc', 'dtd', 'dum', 'eab', 'eca', 'ecb', 'ecc', 'ecd', 'ece', 'ecf', 'ecg', 'ech', 'eci', 'ecj', 'eck', 'ecl', 'ecm', 'ecn', 'eco', 'ecp', 'ecq', 'ecr', 'ecs', 'ect', 'ecu', 'ecv', 'edc', 'edca', 'edi', 'edie', 'edp', 'edq', 'edqa', 'eea', 'eeaa', 'eed', 'eeda', 'eee', 'eft', 'efta', 'ela', 'elb', 'elc', 'eld', 'ele', 'elf', 'epa', 'epaa', 'epb', 'epba', 'epc', 'epd', 'epe', 'epf', 'epfa', 'epm', 'epma', 'epn', 'epna', 'epo', 'epp', 'eppa', 'epq', 'epqa', 'epr', 'epra', 'eps', 'epsa', 'ept', 'epta', 'epu', 'epua', 'epv', 'epva', 'epw', 'epwa', 'epx', 'epxa', 'epy', 'epya', 'epz', 'epza', 'eri', 'esg', 'esga', 'est', 'eta', 'etb', 'etbe', 'etc', 'etd', 'ete', 'etf', 'etg', 'eth', 'eti', 'etj', 'etk', 'etl', 'etm', 'etn', 'etna', 'eto', 'etp', 'etq', 'ets', 'eye', 'eyea', 'fab', 'fau', 'faue', 'fav', 'fca', 'fcb', 'fcd', 'fce', 'fcf', 'fcg', 'fch', 'fci', 'fcj', 'fcl', 'fcm', 'fcn', 'fcp', 'fcq', 'fcr', 'fcs', 'fct', 'fcu', 'fcv', 'fcx', 'fcy', 'fcz', 'fda', 'fdb', 'fdc', 'fdu', 'fdua', 'feb', 'fee', 'fel', 'fele', 'fet', 'ffa', 'ffc', 'ffca', 'ffd', 'ffda', 'fff', 'ffg', 'ffi', 'ffia', 'ffj', 'ffja', 'fga', 'fgl', 'fgla', 'fiq', 'fit', 'fita', 'fite', 'fiv', 'fjh', 'fjha', 'fla', 'flg', 'flga', 'flt', 'flta', 'flu', 'flua', 'flue', 'fly', 'fmj', 'fmja', 'fmz', 'fmza', 'fna', 'fnb', 'fnd', 'fnf', 'fng', 'fnh', 'fni', 'fnj', 'fnk', 'fnl', 'fnn', 'fno', 'fnp', 'fnq', 'fnr', 'fns', 'fnt', 'fnu', 'fnv', 'fnw', 'fnx', 'fny', 'fnz', 'foa', 'fob', 'fof', 'fofa', 'fog', 'foga', 'fon', 'fona', 'fqr', 'frf', 'frfa', 'frl', 'frx', 'fry', 'frz', 'fsa', 'fsb', 'fsc', 'fsd', 'fse', 'fsf', 'fsg', 'fsh', 'fsi', 'fsia', 'fsk', 'fsl', 'fsm', 'fsn', 'fsna', 'fso', 'fst', 'fsx', 'fsy', 'fsya', 'fta', 'ftb', 'ftc', 'ftd', 'fte', 'ftf', 'ftg', 'fth', 'fti', 'ftj', 'ftk', 'ftl', 'ftm', 'ftn', 'fto', 'ftp', 'ftq', 'ftr', 'fts', 'ftt', 'ftu', 'ftv', 'ftw', 'ftwa', 'ftwt', 'ftx', 'fty', 'ftz', 'fua', 'fub', 'fud', 'fue', 'fuf', 'fug', 'fuh', 'fui', 'fuj', 'ful', 'fum', 'fun', 'fuo', 'fup', 'fur', 'fus', 'fut', 'fuu', 'fuv', 'fuw', 'fuy', 'fuz', 'fva', 'fvb', 'fvc', 'fvd', 'fve', 'fvf', 'fvg', 'fvh', 'fvi', 'fvj', 'fvk', 'fvl', 'fvm', 'fvn', 'fvo', 'fvp', 'fvq', 'fvr', 'fvs', 'fvt', 'fvu', 'fvv', 'fvw', 'fvx', 'fwz', 'gaf', 'gah', 'gal', 'gala', 'gan', 'gao', 'gaoa', 'gar', 'gara', 'gare', 'gat', 'gata', 'gcc', 'gcd', 'gdla', 'gdm', 'gdma', 'gea', 'geaa', 'gee', 'geea', 'geo', 'geoa', 'gez', 'geza', 'gfy', 'gfya', 'ggl', 'ghw', 'gie', 'gis', 'gise', 'gme', 'gmee', 'gng', 'gpu', 'gpux', 'gra', 'gsi', 'gui', 'gwe', 'gwea', 'gwg', 'gwga', 'hal', 'hbk', 'hbka', 'hbl', 'hbm', 'hbo', 'hboe', 'hbr', 'hcd', 'hch', 'hci', 'hcj', 'hck', 'hcp', 'hcpd', 'hcz', 'hcza', 'hea', 'heaa', 'hec', 'hed', 'hee', 'hef', 'het', 'heta', 'hex', 'hey', 'heya', 'hfp', 'hha', 'hhb', 'hjm', 'hlz', 'hmc', 'hmca', 'hms', 'hmsa', 'hmse', 'hmst', 'hof', 'hqx', 'hqy', 'hst', 'htp', 'htpa', 'hua', 'hww', 'hwx', 'hwxa', 'hxg', 'hxgd', 'hxs', 'hyb', 'hyc', 'hyd', 'hyk', 'hyka', 'hyl', 'hyla', 'hyp', 'hyw', 'hyx', 'hyxa', 'iab', 'iaba', 'iac', 'iaca', 'iacd', 'iacda', 'iace', 'ibd', 'ibda', 'ibe', 'ibea', 'icc', 'icca', 'icd', 'icda', 'icm', 'icme', 'ict', 'icv', 'idp', 'idpa', 'ifi', 'ilc', 'ild', 'ins', 'iph', 'irl', 'isa', 'isc', 'isd', 'ise', 'isf', 'isg', 'ish', 'isi', 'isj', 'isk', 'isl', 'ism', 'isn', 'iso', 'isp', 'isq', 'isr', 'iss', 'isu', 'isw', 'isx', 'isy', 'ith', 'itha', 'ithd', 'ithda', 'ithe', 'itv', 'jag', 'jah', 'jai', 'jaj', 'jaja', 'jak', 'jan', 'jbw', 'jcy', 'jea', 'jeaa', 'jeb', 'jec', 'jjt', 'jjta', 'jkza', 'jmt', 'jph', 'jsa', 'jsb', 'jsc', 'jsd', 'jse', 'jst', 'jus', 'jusa', 'jwj', 'jxj', 'kag', 'kagd', 'kce', 'kcea', 'kcza', 'kdd', 'kea', 'keae', 'keb', 'keba', 'kem', 'kema', 'ken', 'kena', 'ket', 'kew', 'kewa', 'kex', 'kexa', 'key', 'keya', 'kez', 'keza', 'kfi', 'kfie', 'kfo', 'kga', 'kgh', 'kgi', 'kgj', 'kgk', 'kgl', 'kgn', 'kgo', 'kgp', 'kgq', 'kgr', 'kgs', 'kgt', 'kgu', 'kgz', 'khn', 'kkm', 'kkma', 'kle', 'klea', 'kms', 'kmsa', 'kna', 'knaa', 'knb', 'knba', 'knc', 'knca', 'koh', 'koha', 'kpc', 'kpl', 'ksx', 'kto', 'kts', 'kty', 'ktya', 'kwh', 'kwo', 'kxe', 'kxea', 'law', 'lbt', 'lcs', 'lcsa', 'lcse', 'lcsf', 'lcv', 'lcva', 'lcve', 'lcvf', 'lcwx', 'lcx', 'lcy', 'lcya', 'lcyax', 'lcye', 'lcz', 'lev', 'lfm', 'lhb', 'lhh', 'lib', 'lig', 'lil', 'lim', 'llj', 'llja', 'llk', 'llka', 'lll', 'llz', 'llza', 'lng', 'lnga', 'lni', 'lnj', 'loh', 'lom', 'lon', 'lona', 'lone', 'lonea', 'los', 'lqm', 'lrj', 'lrk', 'lrl', 'lsz', 'lta', 'ltae', 'ltj', 'ltl', 'ltw', 'lul', 'lum', 'lun', 'luo', 'lvt', 'lvta', 'lwa', 'lwad', 'lwg', 'lwga', 'lwh', 'lwha', 'lxx', 'maw', 'maz', 'mbc', 'mcd', 'mcf', 'mcfd', 'mcn', 'mco', 'mcoa', 'mcs', 'mcsa', 'mct', 'mcx', 'mdf', 'mdh', 'mds', 'med', 'mef', 'mep', 'mepe', 'mer', 'mere', 'met', 'meta', 'mfj', 'mft', 'mgc', 'mgca', 'mgcx', 'mgd', 'mgda', 'mgg', 'mgz', 'mgzx', 'mgzxd', 'mgzxde', 'mhg', 'mjb', 'mjd', 'mjha', 'mjt', 'mjy', 'mjz', 'mmg', 'mml', 'mmla', 'mmm', 'mmma', 'mmn', 'mmna', 'mmt', 'moa', 'mob', 'moc', 'mod', 'mof', 'mog', 'moge', 'mok', 'mon', 'mone', 'moo', 'mot', 'mota', 'mote', 'motea', 'mou', 'moue', 'mov', 'moz', 'mrc', 'msd', 'msf', 'msg', 'msh', 'msi', 'msp', 'msq', 'mss', 'mst', 'msw', 'msx', 'mtn', 'mtne', 'mtnea', 'muh', 'muo', 'mur', 'mvy', 'myc', 'myca', 'myd', 'myda', 'mzz', 'nab', 'nas', 'nasd', 'nat', 'naz', 'nazx', 'nba', 'nbd', 'nbo', 'nboa', 'nboae', 'nboh', 'nboxd', 'nca', 'ncb', 'ncba', 'ncc', 'ncd', 'nce', 'ncf', 'nch', 'nci', 'ncj', 'nck', 'ncl', 'ncm', 'neb', 'nebe', 'nfa', 'nfb', 'nfc', 'ngc', 'nha', 'nht', 'nhta', 'nia', 'niaa', 'niad', 'niada', 'niae', 'nin', 'nind', 'nip', 'niq', 'nir', 'nju', 'njua', 'nka', 'nkb', 'nkc', 'nkd', 'nke', 'nkf', 'nkn', 'nko', 'nkp', 'nkq', 'nku', 'nkua', 'nlr', 'nnd', 'nob', 'noc', 'nod', 'noe', 'nof', 'nog', 'noh', 'noi', 'noj', 'nok', 'nol', 'noo', 'noq', 'nor', 'nos', 'not', 'nou', 'noua', 'nov', 'nox', 'noy', 'noz', 'npo', 'npoa', 'npoe', 'nsp', 'nta', 'ntb', 'nth', 'nti', 'ntn', 'ntsa', 'ntt', 'ntta', 'ntu', 'ntua', 'ntv', 'ntva', 'ntw', 'ntwa', 'ntxa', 'ntya', 'nul0', 'num', 'nun', 'nva', 'nvb', 'nyn', 'nyna', 'nzn', 'oab', 'ocu', 'ocua', 'ocue', 'odf', 'odfd', 'odg', 'odh', 'odi', 'odj', 'odk', 'odl', 'odm', 'off', 'ofo', 'ofp', 'ofpa', 'oft', 'oge', 'ogea', 'omy', 'ooa', 'oob', 'ooc', 'ood', 'ooda', 'ooe', 'osa', 'osb', 'osc', 'osd', 'ose', 'osf', 'oso', 'ott', 'otta', 'pbg', 'pbge', 'pbgl', 'pbp', 'pbpe', 'pbpl', 'pbz', 'pbze', 'pbzl', 'pbzll', 'pbzm', 'pcb', 'pcbe', 'pcl', 'pcle', 'pcn', 'pcu', 'pcug', 'pcuge', 'pcuh', 'pcuhe', 'pcui', 'pcum', 'pda', 'pdb', 'pdm', 'pdp', 'pdpa', 'pds', 'pek', 'peka', 'pem', 'pfm', 'pfma', 'pha', 'phi', 'phl', 'phw', 'phwa', 'phx', 'phxa', 'pmc', 'pop', 'popa', 'poz', 'pse', 'psp', 'pspa', 'ptd', 'pte', 'pth', 'ptha', 'pti', 'ptia', 'pto', 'ptoa', 'ptod', 'ptr', 'ptra', 'pts', 'ptsa', 'ptse', 'ptsf', 'ptsg', 'ptsx', 'ptt', 'ptta', 'pyb', 'pyc', 'pyd', 'pyf', 'pyo', 'pyoa', 'pyr', 'pyra', 'pyre', 'pzh', 'pzha', 'qdl', 'qdle', 'qdlea', 'qms', 'qna', 'qnaa', 'qnb', 'qnba', 'qnc', 'qnca', 'qnd', 'qnda', 'qne', 'qnea', 'qnf', 'qnfa', 'qom', 'qoma', 'qrf', 'qsl', 'qsm', 'qtz', 'qtza', 'qtze', 'qtzf', 'qtzg', 'qtzh', 'qtzt', 'qza', 'qzd', 'qzda', 'qzh', 'qzj', 'raa', 'rab', 'rac', 'rad', 'rae', 'reo', 'reod', 'reoda', 'reoe', 'reot', 'rgd', 'rho', 'rhoe', 'rhp', 'rhr', 'rhra', 'rht', 'rhta', 'rhtxa', 'rin', 'rkf', 'rna', 'rnaa', 'rnb', 'rnc', 'rob', 'rra', 'rtl', 'rtla', 'rtw', 'rug', 'sab', 'saba', 'sas', 'sat', 'sbq', 'sbr', 'sbra', 'sca', 'scg', 'scp', 'scpa', 'sct', 'scu', 'scua', 'scuf', 'scug', 'scuh', 'sda', 'sdt', 'sdte', 'sea', 'seb', 'seh', 'sep', 'sepa', 'ses', 'sesa', 'sev', 'sgn', 'sgt', 'shb', 'shba', 'she', 'shea', 'shf', 'sho', 'shoa', 'shp', 'shpa', 'shy', 'sie', 'sig', 'sin', 'sit', 'sita', 'six', 'siy', 'siz', 'sjt', 'sjta', 'ska', 'skb', 'skc', 'skd', 'ske', 'skf', 'skg', 'skh', 'skl', 'skla', 'sku', 'sky', 'skya', 'sln', 'smb', 'smc', 'sme', 'smg', 'smh', 'smi', 'smk', 'sml', 'smm', 'smn', 'smo', 'smp', 'smq', 'smr', 'sms', 'smt', 'smu', 'smv', 'smw', 'snb', 'sne', 'snf', 'sng', 'snh', 'sni', 'snk', 'snl', 'snm', 'sno', 'snp', 'snq', 'snr', 'snv', 'snvx', 'snvx_star', 'snw', 'snx', 'sny', 'soa', 'soc', 'soca', 'sod', 'soda', 'sodaa', 'sodaaa', 'sode', 'sodf', 'sodg', 'sodh', 'sodt', 'soe', 'sof', 'sog', 'soh', 'soi', 'soj', 'sok', 'sol', 'som', 'son', 'soo', 'sop', 'soq', 'sor', 'sos', 'sot', 'sou', 'sow', 'sph', 'spha', 'spl', 'spla', 'spn', 'spna', 'spp', 'sppa', 'sqc', 'sqca', 'sqp', 'sqpa', 'sqs', 'sqsa', 'sra', 'srae', 'srb', 'src', 'srd', 'srdl', 'srr', 'srra', 'srs', 'srsa', 'srsae', 'srsf', 'srsg', 'srst', 'ssa', 'ssaa', 'ssb', 'ssba', 'ssc', 'ssca', 'ssd', 'ssde', 'sse', 'ssee', 'ssf', 'ssfe', 'ssm', 'sspa', 'sss', 'sssa', 'sst', 'ssta', 'sste', 'sta', 'stb', 'stc', 'std', 'stda', 'ste', 'stea', 'sth', 'stj', 'stja', 'stp', 'stpa', 'str', 'stu', 'stua', 'stw', 'stwa', 'stx', 'stxa', 'sty', 'stya', 'sum', 'sur', 'sura', 'sva', 'svb', 'svc', 'svd', 'sve', 'svf', 'svg', 'svh', 'svi', 'svix', 'svj', 'svk', 'svl', 'svm', 'svn', 'svna', 'svnd', 'svo', 'svp', 'svq', 'svr', 'svs', 'svt', 'svu', 'svv', 'svw', 'svx', 'svy', 'svz', 'swa', 'swb', 'swc', 'swd', 'swe', 'swf', 'swg', 'swh', 'swi', 'swj', 'swk', 'swl', 'swm', 'swn', 'swp', 'swq', 'sxa', 'sxb', 'sxc', 'sxcd', 'sxd', 'sxe', 'sxf', 'sxg', 'sxh', 'sxi', 'sxj', 'sxk', 'sxl', 'sxm', 'sxn', 'sxo', 'sxp', 'sxq', 'sxt', 'tap', 'tav', 'tava', 'tbd', 'tbo', 'tboa', 'tbr', 'tca', 'tcd', 'tce', 'tcf', 'tcfx', 'tcg', 'tcgx', 'tch', 'tci', 'tcj', 'tck', 'tcl', 'tcm', 'tco', 'tcs', 'tdc', 'tdd', 'tee', 'teea', 'tei', 'tej', 'ten', 'teo', 'tes', 'tfa', 'tfaa', 'tfb', 'tfba', 'tfc', 'tfce', 'tfd', 'tfe', 'tfea', 'tff', 'tfg', 'tfga', 'tfh', 'tfi', 'tfia', 'tfj', 'tfja', 'tfk', 'tfka', 'tfl', 'tfm', 'tfn', 'tfo', 'tfp', 'tfpa', 'tfq', 'tfqa', 'tfs', 'tfu', 'tfua', 'tfv', 'tfva', 'tfy', 'tfya', 'tfzd', 'the', 'thea', 'thf', 'thh', 'thj', 'thl', 'thp', 'thpa', 'thpx', 'ths', 'thse', 'tie', 'tim', 'tima', 'tmd', 'tna', 'tnn', 'toc', 'toca', 'toce', 'tof', 'ton', 'tona', 'tot', 'tota', 'toz', 'tpd', 'tph', 'tpha', 'tpr', 'tps', 'tpsa', 'tpt', 'tpta', 'tpy', 'tpz', 'tpza', 'tru', 'trua', 'tsa', 'tsaa', 'tsb', 'tsba', 'tsc', 'tsd', 'tse', 'tsf', 'tsg', 'tsga', 'tsh', 'tsha', 'tsi', 'tsj', 'tsja', 'tsl', 'tsn', 'tsna', 'tsq', 'tsqa', 'tst', 'tsta', 'tsx', 'tsxa', 'tsy', 'tta', 'ttc', 'ttd', 'ttf', 'ttg', 'tto', 'ttp', 'ttr', 'ttra', 'ttt', 'ttta', 'ttu', 'ttua', 'ttv', 'ttva', 'ttw', 'ttx', 'ttxa', 'tty', 'ttz', 'tub', 'tuba', 'twf', 'twfa', 'twfd', 'twfda', 'twfe', 'twt', 'twte', 'txt', 'txta', 'tzs', 'ubo', 'uboa', 'ubt', 'ubta', 'uca', 'ucb', 'ucn', 'ucp', 'ucpa', 'ucw', 'ucx', 'ucy', 'ucz', 'uka', 'ukb', 'ukc', 'ukd', 'uke', 'ukf', 'ukg', 'ukh', 'uki', 'ukj', 'ukk', 'ukl', 'ukm', 'ukn', 'uko', 'ukp', 'ukr', 'uks', 'ukt', 'uku', 'ukv', 'ukw', 'ukx', 'uky', 'ula', 'ulf', 'ulg', 'ulh', 'uli', 'ulj', 'ull', 'uma', 'umb', 'umc', 'umd', 'ume', 'umf', 'umg', 'umh', 'umi', 'umj', 'umk', 'uml', 'umm', 'umn', 'umo', 'umq', 'umr', 'ums', 'umt', 'umu', 'umv', 'umw', 'umx', 'umy', 'umz', 'una', 'unb', 'unc', 'und', 'une', 'unf', 'ung', 'unh', 'uni', 'unid', 'unj', 'unl', 'unm', 'unn', 'uno', 'unp', 'unr', 'uns', 'unt', 'unu', 'unv', 'unw', 'unx', 'uny', 'uoa', 'uob', 'uoc', 'uod', 'uoe', 'uof', 'uog', 'uoh', 'uoi', 'uoj', 'uol', 'uom', 'uon', 'uoo', 'uop', 'uoq', 'uos', 'uot', 'uou', 'uov', 'uow', 'uox', 'uoy', 'uoz', 'upa', 'upb', 'upc', 'upd', 'ure', 'urf', 'urfa', 'urg', 'urga', 'urh', 'urha', 'uri', 'uria', 'urj', 'urja', 'urk', 'urka', 'url', 'urla', 'urm', 'urma', 'urn', 'urna', 'uro', 'uroa', 'urp', 'urpa', 'urq', 'urqa', 'urr', 'urra', 'urs', 'ursa', 'urt', 'urta', 'uru', 'urua', 'urv', 'urva', 'urw', 'urwa', 'urx', 'urxa', 'ury', 'urya', 'urz', 'urza', 'usf', 'uta', 'utae', 'utb', 'utc', 'utg', 'utj', 'utk', 'utm', 'utn', 'uto', 'utp', 'utq', 'uty', 'utz', 'vab', 'vba', 'vbb', 'vbc', 'vbd', 'vbe', 'vbf', 'vbg', 'vbh', 'vbi', 'vbj', 'vbk', 'vbl', 'vbm', 'vbn', 'vbo', 'vbp', 'vbq', 'vbr', 'vbs', 'vbt', 'vbu', 'vbv', 'vbw', 'vbx', 'vby', 'vca', 'vcb', 'vcc', 'vcd', 'vce', 'vcf', 'vcg', 'vch', 'vci', 'vcj', 'vck', 'vcl', 'vcm', 'vcn', 'vco', 'vcp', 'vcq', 'vcr', 'vcs', 'vct', 'vcu', 'vcv', 'vcw', 'vcx', 'vcy', 'vcz', 'vda', 'vdb', 'vfi', 'viv', 'viva', 'vma', 'vmb', 'vmc', 'vmd', 'vme', 'vmf', 'vmg', 'vmh', 'vmi', 'vmj', 'vmk', 'vml', 'vmm', 'vmn', 'vmo', 'vmp', 'vmq', 'vmr', 'vms', 'vmt', 'vmu', 'vmv', 'vmw', 'vmx', 'vmy', 'vmz', 'vna', 'vnb', 'vnc', 'vnd', 'vne', 'vnf', 'vng', 'vnh', 'vni', 'vtx', 'vvi', 'vvia', 'wal', 'walx', 'wbl', 'wei', 'wfa', 'wfb', 'wfc', 'wfd', 'wfe', 'wff', 'wfg', 'wfh', 'wfi', 'wfj', 'wfk', 'wfl', 'wfm', 'wfn', 'wfo', 'wfp', 'wfq', 'wfr', 'wfs', 'wft', 'wfu', 'wfv', 'wfw', 'wfx', 'wfy', 'wfz', 'wga', 'wgb', 'wgc', 'wgd', 'wge', 'wgf', 'wgh', 'wgi', 'wgj', 'wgk', 'wgl', 'wgm', 'wgn', 'wgo', 'wgp', 'wgq', 'wgr', 'wgs', 'wgt', 'wgu', 'wgv', 'wgw', 'wgx', 'wgy', 'wgz', 'wha', 'whb', 'whc', 'whd', 'whe', 'whf', 'whg', 'whh', 'whi', 'whj', 'whk', 'whl', 'whm', 'whn', 'who', 'whp', 'whq', 'whr', 'whs', 'wht', 'whu', 'whv', 'whw', 'whx', 'why', 'whz', 'wia', 'wib', 'wid', 'wie', 'wif', 'wig', 'wih', 'wii', 'wij', 'wik', 'wil', 'wim', 'win', 'wio', 'wip', 'wiq', 'wir', 'wis', 'wit', 'wiu', 'wiv', 'wiw', 'wix', 'wiy', 'wiz', 'wja', 'wjb', 'wjc', 'wjd', 'wje', 'wjf', 'wjg', 'wjh', 'wji', 'wjk', 'wjl', 'wjm', 'wjn', 'wjo', 'wjp', 'wjq', 'wjr', 'wjs', 'wjt', 'wju', 'wjv', 'wjw', 'wjx', 'wjy', 'wjz', 'wka', 'wkb', 'wkc', 'wkd', 'wke', 'wkf', 'wkg', 'wkh', 'wki', 'wkj', 'wkk', 'wkl', 'wkm', 'wkn', 'wko', 'wkp', 'wkq', 'wkr', 'wks', 'wkt', 'wku', 'wkv', 'wkw', 'wkx', 'wky', 'wla', 'wlb', 'wlc', 'wld', 'wle', 'wlf', 'wlg', 'wlh', 'wli', 'wlj', 'wlk', 'wll', 'wlm', 'wln', 'wlp', 'wlq', 'wlr', 'wls', 'wlt', 'wlu', 'wma', 'wmb', 'wmc', 'wmd', 'wme', 'wmf', 'wmg', 'wmh', 'wmi', 'wmj', 'wmk', 'wml', 'wmm', 'wmn', 'wmo', 'wmp', 'wmq', 'wmr', 'wms', 'wmt', 'wmu', 'wmv', 'wmw', 'wmx', 'wmy', 'wmz', 'wna', 'wnb', 'wnc', 'wnd', 'wne', 'wnf', 'wng', 'wnh', 'wni', 'wnj', 'wnk', 'wnl', 'wnm', 'wnn', 'wno', 'wnp', 'wnq', 'wnr', 'wns', 'wnt', 'wnu', 'wnv', 'wnw', 'wnx', 'wny', 'wnz', 'wpa', 'wse', 'wsx', 'wut', 'wuy', 'wxs', 'wxsa', 'wys', 'wysa', 'wyt', 'wyta', 'wzz', 'wzza', 'xaa', 'xab', 'xaba', 'xac', 'xad', 'xada', 'xae', 'xaf', 'xag', 'xaga', 'xah', 'xai', 'xaia', 'xaj', 'xaja', 'xak', 'xal', 'xam', 'xan', 'xao', 'xap', 'xaq', 'xar', 'xas', 'xat', 'xata', 'xau', 'xav', 'xaw', 'xax', 'xay', 'xaz', 'xba', 'xbaa', 'xbb', 'xbc', 'xbd', 'xbe', 'xbf', 'xbfa', 'xbg', 'xbh', 'xbi', 'xbj', 'xbk', 'xbka', 'xbl', 'xbm', 'xbna', 'xbo', 'xboa', 'xbp', 'xbpa', 'xbq', 'xbqa', 'xbr', 'xbs', 'xbt', 'xbu', 'xbua', 'xbv', 'xbva', 'xby', 'xbya', 'xbz', 'xbza', 'xca', 'xcb', 'xci', 'xda', 'xfa', 'xfb', 'xfc', 'xfd', 'xfe', 'xff', 'xfg', 'xfh', 'xfi', 'xfj', 'xfk', 'xfl', 'xfm', 'xfn', 'xfo', 'xfp', 'xfq', 'xfr', 'xfs', 'xft', 'xfu', 'xfw', 'xfx', 'xfy', 'xfz', 'xhh', 'xii', 'xij', 'xik', 'xll', 'xlla', 'xly', 'xlya', 'xlz', 'xlza', 'xmz', 'xmza', 'xux', 'xww', 'xxv', 'yac', 'yan', 'yao', 'yaoa', 'yav', 'yava', 'yavd', 'yavda', 'ybh', 'ycq', 'ycr', 'ycs', 'yct', 'ydq', 'ydqa', 'yfa', 'yfb', 'yfc', 'yfd', 'yfe', 'yff', 'yfg', 'yfh', 'yfi', 'yfj', 'yfk', 'yfl', 'yfm', 'yfn', 'yfo', 'yfp', 'yfq', 'yfr', 'yfs', 'yft', 'yfu', 'yfv', 'yfw', 'yfx', 'yfy', 'yfz', 'ykh', 'ylf', 'ytw', 'ytwa', 'yug', 'yyz', 'yzh', 'zaz', 'zba', 'zbb', 'zbc', 'zbd', 'zbe', 'zbf', 'zbg', 'zbh', 'zbi', 'zbj', 'zbk', 'zbl', 'zbm', 'zbn', 'zbo', 'zbp', 'zbq', 'zbr', 'zbs', 'zbt', 'zbu', 'zbv', 'zbw', 'zbx', 'zby', 'zbz', 'zca', 'zcb', 'zcc', 'zcd', 'zce', 'zea', 'zeb', 'zec', 'zfa', 'zfb', 'zfc', 'zfd', 'zfe', 'zff', 'zfg', 'zfh', 'zfi', 'zfj', 'zfk', 'zfl', 'zfm', 'zfn', 'zfo', 'zfp', 'zfq', 'zfr', 'zfs', 'zft', 'zfu', 'zfv', 'zfw', 'zfx', 'zfy', 'zfz', 'zga', 'zhc', 'zhl', 'zim', 'zjz', 'zjza', 'zkf', 'zll', 'zlla', 'zma', 'zmb', 'zmc', 'zmd', 'zme', 'zmj', 'zni', 'znp', 'znz', 'zra', 'zrad', 'zrade', 'zrc', 'zrca', 'zsn', 'zul', 'zxc', 'zxca', 'zxd', 'zyg', 'zyga', 'zyl', 'zyla', 'zzz'];

    var options = '';

    for (var i = 0; i < my_nets.length; i++) {
      options += '<option value="' + my_nets[i] + '" />';
    }

    document.getElementById('nets_list').innerHTML = options; // populating the nets dropdown

    $.get("/new_user").done(
      function(response) {
        // Purpose of this is just to make a user ID for the new browser that has accessed MOFSimplify, so I don't care about the response
        console.log(response)
    })


    // // Let the new user know how many people are currently using MOFSimplify
    // $.get("/curr_users").done(
    //   function(response) {
    //     // Purpose of this is just to make a user ID for the new browser that has accessed MOFSimplify, so I don't care about the response
    //     alert('The current number of users on MOFSimplify: ' + response)
    // })

    // On start up, hide certain sections
    // $('#pills-vis').hide()
    $('#pills-comp').hide()
    $('#pills-bb').hide()

    function viewer_hider() {
      $('#pills-vis').hide()
    }

    // This is my hacky way to get around the fact that the full MOF viewport does not work if it is immediately hidden.
    // I just wait a bit, then hide it
    window.setTimeout(viewer_hider, 5)

  });


</script>

<!-- sbu.js is pulled from https://github.com/snurr-group/web-mofid, for visualization purposes. Not all of the code in it is used by our website. -->
<script async type="text/javascript" src="libraries/sbu.js"></script> 

